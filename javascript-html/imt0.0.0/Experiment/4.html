<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gnomon Triangulator</title>
    <link href="https://fonts.googleapis.com/css2?family=Architects+Daughter&family=Roboto+Mono:wght@500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-paper: #f9f3e3;
            --ink-black: #1a1a1a;
            --ink-red: #c0392b;
            --ink-blue: #2980b9;
            --ink-shadow: #7f8c8d;
            --font-hand: 'Architects Daughter', cursive;
            --font-mono: 'Roboto Mono', monospace;
        }

        body {
            margin: 0;
            background-color: var(--bg-paper);
            color: var(--ink-black);
            font-family: var(--font-hand);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 100vh;
            touch-action: none;
        }

        /* Paper Noise */
        body::before {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23noise)' opacity='0.08'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: -1;
        }

        /* Controls Area */
        .controls {
            padding: 20px;
            background: rgba(255, 255, 255, 0.6);
            border-bottom: 2px solid var(--ink-black);
            z-index: 10;
        }

        .input-row {
            display: flex;
            gap: 20px;
            align-items: center;
            margin-bottom: 10px;
            justify-content: center;
        }

        .label { font-size: 1rem; color: var(--ink-shadow); font-family: var(--font-hand); }
        
        input[type="number"] {
            background: transparent;
            border: none;
            border-bottom: 2px dashed var(--ink-black);
            font-family: var(--font-hand);
            font-size: 1.5rem;
            width: 120px;
            text-align: center;
            color: var(--ink-red);
        }
        input:focus { outline: none; border-bottom: 2px solid var(--ink-red); }

        .slider-container {
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        input[type="range"] {
            flex: 1;
            accent-color: var(--ink-blue);
        }

        /* Canvas Area */
        .stage {
            flex: 1;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

    </style>
</head>
<body>

    <div class="controls">
        <div class="input-row">
            <div>
                <span class="label">TARGET (N)</span><br>
                <input type="number" id="inputN" value="1007" onchange="updateN()">
            </div>
            <div style="width: 20px;"></div>
            <div>
                <span class="label">PIVOT (P)</span><br>
                <input type="number" id="inputP" value="19" onchange="updateP()">
            </div>
        </div>
        <div class="slider-container">
            <span class="label">Slide Pivot:</span>
            <input type="range" id="sliderP" min="1" max="100" value="19" oninput="slideP(this.value)">
        </div>
        <div style="text-align:center; margin-top:5px; font-family:var(--font-mono); font-size:0.8rem; color:var(--ink-blue);" id="statusMsg">
            Checking...
        </div>
    </div>

    <div class="stage">
        <canvas id="triCanvas"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('triCanvas');
        const ctx = canvas.getContext('2d');
        const statusMsg = document.getElementById('statusMsg');
        
        // State
        let N = 1007;
        let Pivot = 19;

        function resize() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            draw();
        }
        window.addEventListener('resize', resize);
        
        // --- Interaction ---
        function updateN() {
            const val = parseInt(document.getElementById('inputN').value);
            if(val > 0) {
                N = val;
                draw();
            }
        }

        function updateP() {
            const val = parseInt(document.getElementById('inputP').value);
            if(val > 0) {
                Pivot = val;
                document.getElementById('sliderP').value = val;
                draw();
            }
        }

        function slideP(val) {
            Pivot = parseInt(val);
            document.getElementById('inputP').value = Pivot;
            draw();
        }

        // --- Drawing Helpers ---
        function drawSketchLine(x1, y1, x2, y2, color, width=2, dashed=false) {
            ctx.beginPath();
            ctx.strokeStyle = color;
            ctx.lineWidth = width;
            ctx.lineCap = 'round';
            if(dashed) ctx.setLineDash([10, 10]);
            else ctx.setLineDash([]);
            
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Jitter
            if(!dashed) {
                ctx.beginPath();
                ctx.lineWidth = width * 0.5;
                ctx.moveTo(x1, y1);
                ctx.quadraticCurveTo((x1+x2)/2 + (Math.random()*4-2), (y1+y2)/2 + (Math.random()*4-2), x2, y2);
                ctx.stroke();
            }
        }

        function drawLabel(val, x, y, color, size, label="") {
            ctx.fillStyle = color;
            ctx.font = `bold ${size}px 'Architects Daughter'`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(val, x, y);
            
            if(label) {
                ctx.fillStyle = '#7f8c8d';
                ctx.font = `${size*0.4}px 'Roboto Mono'`;
                ctx.fillText(label, x, y + size*0.8);
            }
        }

        // --- Main Draw ---
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Check Factorization
            const factorA = N / Pivot;
            const isClean = Number.isInteger(factorA);
            
            if (isClean) {
                statusMsg.innerText = `MATCH FOUND! ${factorA} × ${Pivot} = ${N}`;
                statusMsg.style.color = 'var(--ink-blue)';
            } else {
                statusMsg.innerText = `Searching... (Remainder: ${N % Pivot})`;
                statusMsg.style.color = 'var(--ink-shadow)';
            }

            // Layout
            const cx = canvas.width / 2;
            const cy = canvas.height / 2;
            
            // Triangle Coords
            const topX = cx;
            const topY = cy - 150;
            
            const botY = cy + 150;
            const botX_L = cx - 140; // Left Base
            const botX_R = cx + 140; // Pivot
            
            // --- Draw Connections ---
            
            // 1. N to Pivot (Right Edge)
            drawSketchLine(topX, topY+20, botX_R, botY-30, '#1a1a1a', 2);
            
            // 2. N to Left Base (Hypotenuse/Left Edge)
            // If clean, we show the calculated arm. If not, we show "?"
            drawSketchLine(topX, topY+20, botX_L, botY-30, isClean ? '#2980b9' : '#e74c3c', 2, !isClean);

            // 3. Base Line (The Factor Connection)
            drawSketchLine(botX_L+20, botY, botX_R-20, botY, '#7f8c8d', 1.5, true);


            // --- Draw Numbers ---
            
            // TOP (N)
            drawLabel(N, topX, topY, '#c0392b', 50, "TARGET");

            // BOTTOM RIGHT (Pivot)
            drawLabel(Pivot, botX_R, botY, '#1a1a1a', 40, "PIVOT");

            // BOTTOM LEFT (The Missing Factor)
            const displayA = isClean ? factorA : (factorA.toFixed(2));
            drawLabel(displayA, botX_L, botY, isClean ? '#2980b9' : '#e74c3c', 40, isClean ? "FOUND ARM" : "GAP");

            // --- Visualization of the "Shadow" (Middle Layer) ---
            if(isClean) {
                // Show the "Projection" numbers like in your drawing (21, 15)
                // But simplified: Just show the multiplication logic visually
                ctx.fillStyle = '#7f8c8d';
                ctx.font = '20px monospace';
                ctx.textAlign = 'center';
                ctx.fillText(`×`, (botX_L + botX_R)/2, botY);
            }
        }

        // Init
        updateN();
        resize();

    </script>
</body>
</html>
