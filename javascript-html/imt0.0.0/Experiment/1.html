<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gnomon Navigator v2.0</title>
    <style>
        :root { --bg: #020617; --text: #f1f5f9; --accent: #0ea5e9; --border: #1e293b; --highlight: #f472b6; }
        body { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; background: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; flex-direction: column; height: 100vh; }
        h2 { font-size: 1.1rem; color: var(--accent); letter-spacing: 1px; }
        .controls { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
        input { background: #0f172a; border: 1px solid var(--border); color: white; padding: 12px; border-radius: 4px; font-size: 1rem; width: 100%; box-sizing: border-box; }
        button { background: var(--accent); color: white; border: none; padding: 12px; border-radius: 4px; font-weight: bold; cursor: pointer; text-transform: uppercase; }
        #results { flex: 1; overflow-y: auto; background: #0f172a; border-radius: 4px; padding: 15px; border: 1px solid var(--border); line-height: 1.6; }
        .success { color: #4ade80; border-left: 3px solid #4ade80; padding-left: 10px; margin-bottom: 15px; }
        .stats { color: #94a3b8; font-size: 0.85rem; }
    </style>
</head>
<body>

    <h2>Gnomon Navigator (High Precision)</h2>
    
    <div class="controls">
        <input type="text" id="cargoInput" placeholder="Paste Large Cargo Here" value="32211555687777744111717777">
        <button onclick="unpackBig()">Run Map Analysis</button>
    </div>

    <div id="results">Enter cargo and run analysis...</div>

    <script>
        // BigInt Square Root function (Native JS doesn't have it)
        function bigSqrt(value) {
            if (value < 0n) return null;
            if (value < 2n) return value;
            let x = value / 2n + 1n;
            let y = (x + value / x) / 2n;
            while (y < x) {
                x = y;
                y = (x + value / x) / 2n;
            }
            return x;
        }

        function unpackBig() {
            const inputVal = document.getElementById('cargoInput').value.trim();
            const results = document.getElementById('results');
            results.innerHTML = "Mapping cargo trajectory...";

            try {
                const N = BigInt(inputVal);
                if (N % 2n === 0n) {
                    results.innerHTML = "Error: Cargo is Even. This map tracks Odd Composites.";
                    return;
                }

                // 1. Identify starting point of search from the Square Column
                let maxRoot = bigSqrt(N);
                if (maxRoot % 2n === 0n) maxRoot--;

                let found = false;
                let startTime = performance.now();

                // 2. Step backwards through the Gnomons
                // Note: Large gaps like this require a bit of time
                for (let r = maxRoot; r >= 3n; r -= 2n) {
                    let square = r * r;
                    let gap = r * 2n;
                    let diff = N - square;

                    if (diff % gap === 0n) {
                        let steps = diff / gap;
                        let factorB = r + (steps * 2n);
                        let k = (r - 1n) / 2n;
                        let tapeID = ((k + 1n) * (k + 2n)) / 2n - 1n;

                        let endTime = performance.now();
                        
                        results.innerHTML = `
                            <div class="success">
                                <strong>TARGET UNPACKED</strong><br>
                                ${r} &times; ${factorB}
                            </div>
                            <div class="stats">
                                Root: ${r}<br>
                                Triangular Anchor (k): ${k}<br>
                                Tape Address: ${tapeID}<br>
                                Row Gap: ${gap}<br>
                                Compute Time: ${(endTime - startTime).toFixed(2)}ms
                            </div>
                        `;
                        found = true;
                        break;
                    }
                    
                    // Safety break for extremely long searches on mobile
                    if (performance.now() - startTime > 5000) {
                        results.innerHTML = "Search Timeout: Root is likely much smaller than the square root. Narrowing focus...";
                        break;
                    }
                }

                if (!found) {
                    results.innerHTML = "No grid match found in this sector. Number is likely Prime or requires deeper row scanning.";
                }

            } catch (e) {
                results.innerHTML = "Error: Invalid number format.";
            }
        }
    </script>
</body>
</html>
