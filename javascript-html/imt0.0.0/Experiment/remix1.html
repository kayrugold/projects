<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SOLID KEY v1.0 [HYBRID NAV]</title>
    <style>
        :root {
            --bg: #020617; --panel: #0f172a; --cyan: #22d3ee; --pink: #f472b6; --gold: #fbbf24;
        }
        body { background: var(--bg); color: #e2e8f0; font-family: monospace; margin: 0; overflow: hidden; }
        .hud { position: absolute; top: 0; width: 100%; padding: 10px; display: flex; gap: 10px; z-index: 10; }
        .stat { background: rgba(15, 23, 42, 0.9); padding: 8px; border: 1px solid var(--cyan); border-radius: 4px; font-size: 0.8rem; }
        .decoder { position: absolute; bottom: 0; width: 100%; background: var(--panel); border-top: 3px solid var(--pink); padding: 15px; box-sizing: border-box; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .val { font-size: 1.2rem; font-weight: bold; color: #fff; }
        .lbl { font-size: 0.6rem; color: #94a3b8; text-transform: uppercase; }
        canvas { display: block; width: 100vw; height: 100vh; }
        .resonance { color: var(--gold); font-weight: bold; }
    </style>
</head>
<body>
    <div class="hud">
        <div class="stat">FIND N: <input id="inpN" type="text" style="background:#1e293b; color:#fff; border:none; width:80px;"> <button onclick="lookup()">SCAN</button></div>
    </div>

    <canvas id="canvas"></canvas>

    <div class="decoder">
        <div>
            <div class="lbl">CODEX ADDR (R.r)</div>
            <div id="dispCodex" class="val">--</div>
            <div class="lbl">NAV ADDR (a.b)</div>
            <div id="dispNav" class="val" style="color:var(--pink)">--</div>
        </div>
        <div style="text-align:right">
            <div class="lbl">CARGO (N)</div>
            <div id="dispCargo" class="val">--</div>
            <div class="lbl">FACTORS</div>
            <div id="dispFactors" class="val" style="color:var(--cyan)">--</div>
            <div id="dispRes" class="resonance">--</div>
        </div>
    </div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let cellS = 60; let offsetX = window.innerWidth / 2; let offsetY = 50;

    function sqrtBig(n) {
        if (n < 2n) return n;
        let x = n, y = (x + 1n) / 2n;
        while (y < x) { x = y; y = (n / x + x) / 2n; }
        return x;
    }

    function getHybrid(N_val) {
        let N = BigInt(N_val);
        let R = sqrtBig(N);
        if (R * R < N) R++;
        let r = (R * R) - N; // Displacement
        
        let a = 2n * R - 1n; // Anchor
        let b = r / 2n;      // Gap
        
        // Resonance Check (The 21-Landmark)
        let res = "";
        if (N % 21n === 0n && N !== 21n) res = "RESONANCE: FAMILY OF 21";

        return { N, R, r, a, b, factors: `${a} x ${a - 2n * b}`, res };
    }

    function draw() {
        ctx.fillStyle = "#020617"; ctx.fillRect(0, 0, canvas.width, canvas.height);
        let midX = offsetX;
        for (let row = 0; row < 20; row++) {
            for (let col = -row; col <= row; col++) {
                let x = midX + col * cellS;
                let y = offsetY + row * cellS;
                
                // Codex Logic: Find N at this coordinate
                let R = BigInt(row) + 1n;
                let r_disp = BigInt(row - col);
                let N = (R * R) - r_disp;

                ctx.strokeStyle = "#1e293b";
                ctx.strokeRect(x - cellS/2, y - cellS/2, cellS, cellS);
                ctx.fillStyle = "#64748b";
                ctx.font = "10px monospace";
                ctx.textAlign = "center";
                ctx.fillText(N.toString(), x, y);
            }
        }
    }

    function lookup() {
        let n = document.getElementById('inpN').value;
        let data = getHybrid(n);
        document.getElementById('dispCargo').innerText = data.N;
        document.getElementById('dispCodex').innerText = `${data.R}.${data.r}`;
        document.getElementById('dispNav').innerText = `${data.a}.${data.b}`;
        document.getElementById('dispFactors').innerText = data.factors;
        document.getElementById('dispRes').innerText = data.res;
    }

    window.onload = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; draw(); };
</script>
</body>
</html>
