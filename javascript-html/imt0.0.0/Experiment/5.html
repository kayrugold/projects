<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gnomon Pocket Solver</title>
    <link href="https://fonts.googleapis.com/css2?family=Architects+Daughter&family=Roboto+Mono:wght@500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-paper: #f9f3e3;
            --ink-black: #1a1a1a;
            --ink-red: #c0392b;
            --ink-blue: #2980b9;
            --ink-green: #27ae60;
            --font-hand: 'Architects Daughter', cursive;
            --font-mono: 'Roboto Mono', monospace;
        }

        body {
            margin: 0;
            background-color: var(--bg-paper);
            color: var(--ink-black);
            font-family: var(--font-hand);
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(255,255,255,0.5);
            padding: 20px;
            border: 2px solid var(--ink-black);
            border-radius: 255px 15px 225px 15px/15px 225px 15px 255px;
            box-shadow: 5px 5px 0 rgba(0,0,0,0.1);
        }

        h1 { margin-top: 0; text-align: center; color: var(--ink-red); border-bottom: 2px dashed var(--ink-black); padding-bottom: 10px; }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        input {
            background: transparent;
            border: none;
            border-bottom: 2px solid var(--ink-black);
            font-family: var(--font-mono);
            font-size: 1.5rem;
            width: 150px;
            text-align: center;
            color: var(--ink-blue);
        }
        input:focus { outline: none; border-color: var(--ink-red); }

        button {
            background: var(--ink-black);
            color: #fff;
            border: none;
            padding: 10px 20px;
            font-family: var(--font-hand);
            font-size: 1.2rem;
            cursor: pointer;
            border-radius: 5px;
        }

        .section {
            margin-bottom: 25px;
            padding: 15px;
            background: #fff;
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 8px;
        }

        .section-title {
            font-weight: bold;
            color: var(--ink-shadow);
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }

        .mono { font-family: var(--font-mono); word-break: break-all; font-size: 0.9rem; }
        
        .highlight { color: var(--ink-red); font-weight: bold; }
        .success { color: var(--ink-green); }

        .ladder-vis {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }
        .ladder-step {
            padding: 4px 8px;
            background: #eee;
            border-radius: 4px;
            font-family: var(--font-mono);
            font-size: 0.8rem;
        }
        .ladder-step.start { background: var(--ink-blue); color: #fff; }
        .ladder-step.end { background: var(--ink-red); color: #fff; }
        .ladder-step.mid { background: #ddd; color: #888; }

    </style>
</head>
<body>

<div class="container">
    <h1>POCKET SOLVER</h1>
    
    <div class="input-group">
        <input type="number" id="inputN" placeholder="Target N" value="1007">
        <button onclick="solve()">SOLVE</button>
    </div>

    <div class="section" id="geoSection" style="display:none;">
        <div class="section-title">GEOMETRY (Difference of Squares)</div>
        <div class="mono" id="geoResult"></div>
    </div>

    <div class="section" id="ladderSection" style="display:none;">
        <div class="section-title">THE LADDER SEQUENCE</div>
        <div style="font-size: 0.9rem; margin-bottom:5px;">Odd numbers that sum to <span id="targetVal"></span>:</div>
        <div class="ladder-vis" id="ladderVis"></div>
        <div class="mono" style="margin-top:10px; color:#555;" id="ladderMath"></div>
    </div>

    <div class="section" id="stripSection" style="display:none;">
        <div class="section-title">STRIPPING SEQUENCE (-4 Step)</div>
        <div class="mono" id="stripResult"></div>
        <div class="mono" id="stripCheck" style="margin-top:10px;"></div>
    </div>

</div>

<script>
    function solve() {
        const N = parseInt(document.getElementById('inputN').value);
        if (!N || N < 1) return;

        // 1. Find Factors (Simple trial division for "Pocket" demo)
        // In a real app, this would be the "Hunt", but here we visualize the result
        let factorA = 0, factorB = 0;
        const limit = Math.floor(Math.sqrt(N));
        
        // Find largest factor <= sqrt
        for (let i = limit; i >= 1; i--) {
            if (N % i === 0) {
                factorB = i;        // Smaller
                factorA = N / i;    // Larger
                break;
            }
        }

        // Geometry Calculations
        // N = M^2 - K^2
        // M (Midpoint) = (A + B) / 2
        // K (Offset)   = (A - B) / 2
        
        // Check parity (must be same parity for integer squares)
        if ((factorA % 2) !== (factorB % 2)) {
            // This happens for even numbers sometimes if factors mix odd/even
            // For N=1007 (odd), factors are odd, so parity matches.
        }

        const M = (factorA + factorB) / 2;
        const K = (factorA - factorB) / 2;
        const M2 = M*M;
        const K2 = K*K;

        // --- Render Geometry ---
        const geoDiv = document.getElementById('geoSection');
        geoDiv.style.display = 'block';
        document.getElementById('geoResult').innerHTML = `
            Factors: <span class="highlight">${factorA}</span> × <span class="highlight">${factorB}</span><br>
            Midpoint (Roof): <span class="highlight">${M}²</span> (${M2})<br>
            Offset (Floor): <span class="highlight">${K}²</span> (${K2})<br>
            Check: ${M2} - ${K2} = ${M2 - K2}
        `;

        // --- Render Ladder ---
        // Sum of odds from (K*2 + 1) to (M*2 - 1)
        // Start Odd = 2K + 1
        // End Odd   = 2M - 1
        const startOdd = (2 * K) + 1; // e.g., 2(17)+1 = 35
        const endOdd = (2 * M) - 1;   // e.g., 2(36)-1 = 71
        
        const ladderDiv = document.getElementById('ladderSection');
        ladderDiv.style.display = 'block';
        document.getElementById('targetVal').innerText = N;
        
        let ladderHTML = '';
        const steps = [];
        // Generate steps (limit visual length for massive numbers)
        let count = 0;
        let sum = 0;
        for (let o = startOdd; o <= endOdd; o += 2) {
            steps.push(o);
            sum += o;
            count++;
            if (count < 6) {
                ladderHTML += `<div class="ladder-step ${o===startOdd?'start':''}">${o}</div>`;
            } else if (count === 6) {
                ladderHTML += `<div class="ladder-step mid">...</div>`;
            }
        }
        // Always show last
        if (count > 6) {
            ladderHTML += `<div class="ladder-step end">${endOdd}</div>`;
        } else if (count === 6) {
             // if exactly 6, just show last
             ladderHTML += `<div class="ladder-step end">${endOdd}</div>`;
        }

        document.getElementById('ladderVis').innerHTML = ladderHTML;
        document.getElementById('ladderMath').innerHTML = `
            Starts at: <b>${startOdd}</b> (Hidden Square ${K}²)<br>
            Ends at: <b>${endOdd}</b><br>
            Total Steps: ${count}
        `;

        // --- Render Stripping (Factor B analysis) ---
        const stripDiv = document.getElementById('stripSection');
        stripDiv.style.display = 'block';
        
        // Sequence: B, B-4, B-8... until > 0
        let stripSum = 0;
        let seqStr = "";
        let terms = 0;
        for (let s = factorB; s > 0; s -= 4) {
            stripSum += s;
            seqStr += s + (s > 4 ? " + " : "");
            terms++;
        }
        
        const remainder = (factorB * factorB) - stripSum;
        const fitCheck = remainder / K; // Should be Integer
        
        document.getElementById('stripResult').innerHTML = `
            Sequence: ${seqStr} = <b>${stripSum}</b>
        `;
        
        document.getElementById('stripCheck').innerHTML = `
            Factor Squared: ${factorB}² = ${factorB*factorB}<br>
            Difference: ${factorB*factorB} - ${stripSum} = ${remainder}<br>
            Offset Check: ${remainder} ÷ ${K} = <span class="success"><b>${fitCheck}</b></span>
        `;
    }
</script>

</body>
</html>
