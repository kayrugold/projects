<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Holographic Engine (Safe Mode)</title>
<style>
    body { background: #0f172a; color: #e2e8f0; font-family: 'Courier New', monospace; padding: 20px; }
    .card { background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px; max-width: 600px; margin: 0 auto; box-shadow: 0 4px 20px rgba(0,0,0,0.5); }
    h1 { color: #f43f5e; font-size: 20px; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; }
    .subtitle { color: #94a3b8; font-size: 12px; margin-bottom: 20px; border-bottom: 1px solid #334155; padding-bottom: 10px; }
    
    .status-box { background: #020617; border: 1px solid #334155; border-radius: 6px; padding: 15px; margin-bottom: 15px; font-size: 14px; min-height: 100px; }
    .stat-row { display: flex; justify-content: space-between; margin-bottom: 5px; }
    .label { color: #64748b; font-size: 11px; text-transform: uppercase; }
    .val { color: #22c55e; font-weight: bold; }
    .vector { color: #f43f5e; word-break: break-all; font-size: 12px; margin-top: 5px; }
    
    .btn { background: #f43f5e; color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; font-weight: bold; font-size: 16px; cursor: pointer; text-transform: uppercase; }
    .btn:active { background: #be123c; }
    .btn:disabled { background: #475569; cursor: not-allowed; }

    .log { margin-top: 15px; font-size: 11px; color: #94a3b8; max-height: 150px; overflow-y: auto; white-space: pre-wrap; }
</style>
</head>
<body>

<div class="card">
    <h1>Holographic Engine</h1>
    <div class="subtitle">Symbolic Arithmetic • Vector State Machine</div>

    <div class="status-box">
        <div class="stat-row">
            <span class="label">Target Form</span>
            <span class="val" style="color:#e2e8f0">10^E + 61</span>
        </div>
        <div class="stat-row">
            <span class="label">Reduction Rule</span>
            <span class="val" style="color:#f43f5e">H ≡ -61</span>
        </div>
        <hr style="border-color:#1e293b; margin:10px 0;">
        <div class="stat-row">
            <span class="label">Current Vector [A, B]</span>
        </div>
        <div id="vectorDisplay" class="vector">[ Ready ]</div>
    </div>

    <button id="btnRun" class="btn" onclick="startEngine()">Ignite Engine (E=2000)</button>
    <div id="console" class="log">System Standby.</div>
</div>

<script>
// WORKER CODE BLOB
const workerScript = `
self.onmessage = function(e) {
    const { exponent, add } = e.data;
    
    // SETUP
    const H_POW = BigInt(exponent); // e.g. 2000
    const ADD = BigInt(add);        // 61
    
    // Note: We do NOT calculate H = 10^Exponent because that crashes RAM.
    // We treat 'H' as a symbolic ceiling.
    // However, to do the math, we need to know when B overflows H.
    // We can use a simpler check: String length or approximate comparison.
    // For this demo, we will use a "Scale Model" where we CAN calculate H 
    // to prove the logic, but keep E reasonable (2000).
    
    const H = 10n ** H_POW; 
    
    // N = H + 61
    // We want to test a base, say 2.
    // We compute 2^(N-1) mod N using the Vector Method.
    
    let stateA = 0n;
    let stateB = 2n; // Initial value 2
    
    // The Exponent to raise 2 to is (N-1)
    // N-1 = H + 60.
    // Binary expansion of H + 60 is huge.
    // We will simulate the "Squaring Loop" for a fixed number of steps
    // to show the engine running.
    
    const STEPS = 500; // Run 500 symbolic squarings
    
    for(let i=0; i<STEPS; i++) {
        // SQUARE THE STATE [A, B]
        // (AH + B)^2 = A^2 H^2 + 2ABH + B^2
        // H^2 -> 3721 (since H = -61, H^2 = 3721)
        // H -> -61
        
        // 1. Calculate raw terms
        const termH2 = stateA * stateA * (ADD * ADD); // A^2 * 3721
        const termH  = 2n * stateA * stateB;          // 2AB
        const term1  = stateB * stateB;               // B^2
        
        // 2. Combine into standard polynomial form: (termH)H + (termH2 + term1)
        // New A (before reduction)
        let newA = termH;
        // New B (before reduction)
        let newB = termH2 + term1;
        
        // 3. REDUCTION (The "Folding")
        // If B >= H, fold it back into A
        // B = qH + r -> A becomes A + q, B becomes r
        // Then apply A -> A*(-61) to move A's magnitude into B
        
        // Standardize: B can be huge. We need B % N.
        // N = H + 61.
        
        // Let's do the "Holographic Fold"
        // Val = newA * H + newB
        // Replace H with -61
        
        // This is the "Cheat": We don't maintain A and B separately forever,
        // we collapse them to keep the number from exploding to infinity.
        // Val = newA * (-ADD) + newB
        
        let val = newA * (-ADD) + newB;
        
        // Normalize (handle negatives)
        // We are effectively working mod (H + 61)
        const N = H + ADD;
        val = val % N;
        if (val < 0n) val += N;
        
        // Split back into Vector [A, B] for display
        // This is purely visual to show the "Engine" state
        stateA = val / H;
        stateB = val % H;
        
        // Report
        if (i % 5 === 0) {
            // Send simplified view to UI
            const lenA = stateA.toString().length;
            const lenB = stateB.toString().length;
            
            // Just send lengths and head/tail to save bandwidth
            postMessage({
                type: 'step', 
                iter: i, 
                vec: \`A[len:\${lenA}] : B[len:\${lenB}]\`,
                rawB: stateB.toString().substring(0, 10) + "..."
            });
        }
        
        // Slow down slightly so human can see it
        const start = Date.now();
        while (Date.now() - start < 20); 
    }
    
    postMessage({type: 'done'});
};
`;

let worker;

function log(msg) {
    const el = document.getElementById('console');
    el.textContent += "> " + msg + "\n";
    el.scrollTop = el.scrollHeight;
}

function startEngine() {
    if(worker) worker.terminate();
    
    document.getElementById('btnRun').disabled = true;
    document.getElementById('btnRun').innerText = "ENGINE RUNNING...";
    document.getElementById('console').textContent = "";
    
    log("Allocating Worker Thread...");
    
    const blob = new Blob([workerScript], {type: 'application/javascript'});
    worker = new Worker(URL.createObjectURL(blob));
    
    log("Initializing Vector Space (10^2000)...");
    
    worker.onmessage = function(e) {
        if(e.data.type === 'step') {
            document.getElementById('vectorDisplay').innerText = 
                `ITER ${e.data.iter}\n${e.data.vec}\nVal: ${e.data.rawB}`;
        }
        if(e.data.type === 'done') {
            log("Sequence Complete.");
            document.getElementById('btnRun').disabled = false;
            document.getElementById('btnRun').innerText = "IGNITE ENGINE (E=2000)";
            document.getElementById('vectorDisplay').innerText = "[ STANDBY ]";
        }
    };
    
    worker.postMessage({ exponent: 2000, add: 61 });
}
</script>
</body>
</html>
