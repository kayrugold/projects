<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prime Rhythm Machine (Fixed)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { background-color: #0f172a; color: white; font-family: 'Courier New', monospace; overflow-x: hidden; }
        
        /* The Scrolling Animation */
        .tape-container {
            display: flex;
            gap: 1rem;
            transition: transform 0.3s linear; /* Smooth movement */
        }
        
        /* Glow effects */
        .glow-blue { box-shadow: 0 0 20px #3b82f6; }
        .glow-red { box-shadow: 0 0 20px #ef4444; }
        
        /* Loading/Error Fallback */
        #root:empty::before {
            content: "Loading Rhythm Engine...";
            display: block;
            padding: 20px;
            text-align: center;
            color: #64748b;
        }
    </style>

    <!-- Error Catcher -->
    <script>
        window.onerror = function(message, source, lineno, colno, error) {
            const el = document.getElementById('error-box');
            if (el) {
                el.style.display = 'block';
                el.innerHTML = "System Error: " + message;
            }
        };
    </script>
</head>
<body>

<div id="error-box" style="display:none; background: red; color: white; padding: 10px; text-align: center; font-weight: bold;"></div>
<div id="root"></div>

<script type="text/babel">

// --- Logic Outside Component to prevent Reload Errors ---

const checkPrime = (num) => {
    if (num <= 1) return false;
    if (num <= 3) return true;
    if (num % 2 === 0 || num % 3 === 0) return false;
    for (let i = 5; i * i <= num; i += 6) {
        if (num % i === 0 || num % (i + 2) === 0) return false;
    }
    return true;
};

const generateBeats = (count) => {
    let beats = [];
    for (let i = 1; i <= count; i++) {
        const num = 2 * i - 1; // The odd number (Layer size)
        
        // The Pattern Logic
        const isDiv3 = (num > 3 && num % 3 === 0); // Divisible by 3 (but not 3 itself)
        const isPrimeVal = checkPrime(num);
        
        // Determine the "Rhythm Type"
        let type = 'potential'; // The default safe spots (6k +/- 1)
        if (isDiv3) type = 'dead'; // The repeating 3s
        if (num === 3) type = 'prime'; // Special case
        
        beats.push({
            layer: i,
            num: num,
            type: type,
            isPrime: isPrimeVal
        });
    }
    return beats;
};

// --- Main App ---

const App = () => {
    const [position, setPosition] = React.useState(0);
    const [isPlaying, setIsPlaying] = React.useState(false);
    
    // Generate data once
    const beats = React.useMemo(() => generateBeats(100), []);

    // Animation Loop
    React.useEffect(() => {
        let interval;
        if (isPlaying) {
            interval = setInterval(() => {
                setPosition(prev => {
                    // Loop or stop at end? Let's loop for rhythm feeling
                    if (prev >= beats.length - 5) {
                        return 0; 
                    }
                    return prev + 1;
                });
            }, 500); // 500ms per beat
        }
        return () => clearInterval(interval);
    }, [isPlaying, beats.length]);

    // Calculate scroll offset based on card width (80px) + gap (16px)
    // We center the active card. 
    const cardWidth = 80; 
    const gap = 16;
    const offset = position * (cardWidth + gap);

    return (
        <div className="min-h-screen flex flex-col items-center justify-center bg-slate-950 p-4">
            
            {/* Header */}
            <div className="mb-12 text-center">
                <h1 className="text-4xl font-bold tracking-tight text-white mb-2">PRIME <span className="text-blue-500">RHYTHM</span></h1>
                <p className="text-xs text-slate-500 uppercase tracking-[0.3em]">The heartbeat of the grid</p>
            </div>

            {/* The Machine */}
            <div className="w-full max-w-3xl relative overflow-hidden py-12 bg-slate-900 border-y border-slate-800 rounded-lg shadow-2xl">
                
                {/* The Selection Line (Center Indicator) */}
                <div className="absolute left-1/2 top-0 bottom-0 w-[2px] bg-yellow-400/50 z-30 transform -translate-x-1/2 shadow-[0_0_10px_#facc15]"></div>

                {/* The Scrolling Tape */}
                <div 
                    className="tape-container items-center pl-[50%] pr-[50%]" // Padding centers the first/last items
                    style={{ 
                        transform: `translateX(-${offset + (cardWidth/2)}px)`, // Center the active card
                    }}
                >
                    {beats.map((beat, idx) => {
                        const isActive = idx === position;
                        
                        // Visual Styles based on pattern
                        let cardClass = "bg-slate-800 border-slate-700 text-slate-500 scale-90 opacity-50"; 
                        
                        if (isActive) {
                            cardClass = "scale-110 opacity-100 z-20 shadow-2xl ring-2 ring-white/20 "; // Active Base
                            if (beat.type === 'dead') cardClass += "bg-red-600 border-red-500 text-white glow-red";
                            else if (beat.isPrime) cardClass += "bg-blue-500 border-blue-400 text-white glow-blue";
                            else cardClass += "bg-orange-500 border-orange-400 text-white"; // Composite
                        } else {
                            // Inactive styles
                            if (beat.type === 'dead') cardClass += " bg-red-900/10 border-red-900/30";
                            else if (beat.isPrime) cardClass += " bg-blue-900/20 border-blue-900/30";
                            else cardClass += " bg-orange-900/10 border-orange-900/30";
                        }

                        return (
                            <div 
                                key={beat.num}
                                className={`
                                    flex-none w-20 h-24 rounded-xl border-2 flex flex-col items-center justify-center transition-all duration-300
                                    ${cardClass}
                                `}
                            >
                                <span className="text-[10px] font-bold uppercase mb-1 opacity-70">
                                    {beat.type === 'dead' ? 'DEAD' : ''}
                                    {beat.isPrime ? 'PRIME' : ''}
                                    {!beat.isPrime && beat.type !== 'dead' ? 'COMP' : ''}
                                </span>
                                <span className="text-2xl font-bold font-mono">{beat.num}</span>
                            </div>
                        );
                    })}
                </div>
                
                {/* Vignette Fades */}
                <div className="absolute inset-y-0 left-0 w-1/3 bg-gradient-to-r from-slate-900 via-slate-900/80 to-transparent z-10 pointer-events-none"></div>
                <div className="absolute inset-y-0 right-0 w-1/3 bg-gradient-to-l from-slate-900 via-slate-900/80 to-transparent z-10 pointer-events-none"></div>

            </div>

            {/* Controls */}
            <div className="mt-12 flex gap-4">
                <button 
                    onClick={() => setIsPlaying(!isPlaying)}
                    className="px-8 py-3 bg-white text-slate-950 font-bold rounded-full hover:bg-slate-200 transition-colors flex items-center gap-2 shadow-lg shadow-white/10"
                >
                    {isPlaying ? "PAUSE ||" : "PLAY â–¶"}
                </button>
                
                <button 
                    onClick={() => {setIsPlaying(false); setPosition(0);}}
                    className="px-6 py-3 border border-slate-700 text-slate-400 font-bold rounded-full hover:text-white hover:border-slate-500 transition-colors"
                >
                    RESET
                </button>
            </div>
            
            <div className="mt-8 text-center max-w-md bg-slate-900/50 p-4 rounded-lg border border-slate-800">
                <p className="text-slate-400 text-xs font-mono">
                    RHYTHM DETECTED:
                </p>
                <div className="flex justify-center gap-2 mt-2 text-xs font-bold">
                   <span className="text-blue-400">ALIVE</span>
                   <span className="text-slate-600">-</span>
                   <span className="text-blue-400">ALIVE</span>
                   <span className="text-slate-600">-</span>
                   <span className="text-red-500">DEAD</span>
                </div>
            </div>

        </div>
    );
};

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);

</script>
</body>
</html>

