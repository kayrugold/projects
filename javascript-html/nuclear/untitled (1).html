<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mersenne Stride Hunter v1.0</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
    body { background-color: #000; color: #e2e8f0; font-family: 'Courier New', monospace; padding: 15px; }
    .card { background: #0f172a; border: 1px solid #1e293b; border-radius: 12px; padding: 20px; max-width: 700px; margin: 0 auto; box-shadow: 0 0 50px rgba(56, 189, 248, 0.15); }
    
    /* INPUTS */
    label { display: block; font-size: 0.7rem; color: #64748b; margin-bottom: 2px; text-transform: uppercase; letter-spacing: 1px; }
    input, select { width: 100%; background: #1e293b; border: 1px solid #334155; color: #38bdf8; padding: 12px; border-radius: 6px; font-weight: bold; font-family: monospace; text-align: center; margin-bottom: 15px; font-size: 1.1rem; }
    input:focus { outline: none; border-color: #38bdf8; }
    
    /* BUTTONS */
    .btn { width: 100%; padding: 16px; border-radius: 8px; font-weight: 900; cursor: pointer; text-transform: uppercase; margin-top: 5px; transition: all 0.2s; letter-spacing: 2px; }
    .btn-run { background: #0284c7; color: #fff; border: 1px solid #0369a1; box-shadow: 0 4px 15px rgba(56, 189, 248, 0.4); }
    .btn-run:hover { background: #0ea5e9; }
    .btn-stop { background: #ef4444; color: #fff; display: none; }
    
    /* DASHBOARD */
    .status-panel { margin-top: 20px; border-top: 1px dashed #334155; padding-top: 15px; }
    .cores-grid { display: grid; grid-template-columns: 1fr; gap: 8px; margin-top: 15px; max-height: 400px; overflow-y: auto; }
    .core-row { background: #020617; padding: 10px; border-radius: 6px; border: 1px solid #1e293b; display: flex; flex-direction: column; }
    .core-active { border-color: #38bdf8; box-shadow: 0 0 10px rgba(56, 189, 248, 0.1); }
    .core-header { display: flex; justify-content: space-between; font-size: 0.75rem; color: #94a3b8; margin-bottom: 6px; font-weight: bold; }
    .progress-bg { height: 8px; background: #1e293b; width: 100%; border-radius: 4px; overflow: hidden; }
    .progress-fill { height: 100%; background: #38bdf8; width: 0%; transition: width 0.2s; box-shadow: 0 0 8px #38bdf8; }

    .log-box { height: 150px; overflow-y: auto; font-size: 0.75rem; color: #64748b; margin-top: 15px; font-family: monospace; background: #020617; padding: 10px; border-radius: 6px; border: 1px solid #1e293b; }
    .hit { color: #ef4444; font-weight: bold; }
    .safe { color: #22c55e; }
    .sys { color: #38bdf8; }
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
</style>
</head>
<body>

<div class="card">
    <h1 class="text-2xl font-black text-center text-sky-400 mb-1">MERSENNE HUNTER</h1>
    <p class="text-center text-xs text-gray-500 mb-6">BASE-2 HOLOGRAPHIC STRIDE</p>

    <label>MERSENNE EXPONENT (q)</label>
    <input id="inpExp" value="11" placeholder="e.g. 11 for 2047">

    <div class="grid-2">
        <div>
            <label style="color:#38bdf8">START SEARCH (p)</label>
            <input id="inpStart" value="0" style="border-color:#0ea5e9; color:#38bdf8">
        </div>
        <div>
            <label>END SEARCH (p)</label>
            <input id="inpEnd" value="1000">
        </div>
    </div>
    
    <label>CPU CORES</label>
    <select id="inpCores">
        <option value="2">2 Cores</option>
        <option value="4" selected>4 Cores</option>
        <option value="6">6 Cores</option>
        <option value="8">8 Cores</option>
    </select>

    <button id="btnStart" class="btn btn-run" onclick="startScan()">DEPLOY MERSENNE FLEET</button>
    <button id="btnStop" class="btn btn-stop" onclick="stopScan()">ABORT MISSION</button>
    
    <div class="status-panel">
        <div class="stat-row" style="display:flex; justify-content:space-between; font-size:0.9rem;">
            <span>Target:</span><span id="sTarget" class="text-white font-bold">2^11 - 1</span>
        </div>
        <div class="stat-row" style="display:flex; justify-content:space-between; font-size:0.9rem;">
            <span>Status:</span><span id="sStatus" class="text-gray-500">READY</span>
        </div>
        
        <div id="coresContainer" class="cores-grid"></div>
        <div id="logBox" class="log-box">System Ready.<br>Targeting 2^q - 1.<br>Using I = 2^(q-1).</div>
    </div>
</div>

<script>
let workers = [];
let activeWorkers = 0;

// --- WORKER CODE ---
const workerCode = `
self.onmessage = function(e) {
    const { qStr, startStr, endStr, workerId } = e.data;
    
    try {
        const q = BigInt(qStr); // The Mersenne Exponent
        const startLimit = parseInt(startStr);
        const endLimit = parseInt(endStr);

        // Modular Exponentiation: Base^Exp % Mod
        function powMod(b, e, m) {
            let res = 1n;
            b = b % m;
            while (e > 0n) {
                if ((e & 1n) === 1n) res = (res * b) % m;
                b = (b * b) % m;
                e = e >> 1n;
            }
            return res;
        }

        // Generate Primes Sieve (The Search Space)
        // We are searching for factors 'p'
        const sieveSize = endLimit + 100;
        const sieve = new Uint8Array(sieveSize);
        const primes = [];
        for(let i=2; i<sieveSize; i++) {
            if(sieve[i] === 0) {
                if(i >= startLimit && i <= endLimit) primes.push(i);
                for(let j=i*i; j<sieveSize; j+=i) sieve[j] = 1;
            }
        }
        
        // THE MERSENNE SCAN
        let processed = 0;
        const total = primes.length;

        for(let i=0; i<primes.length; i++) {
            const P = BigInt(primes[i]); // The Candidate Factor
            
            // --- HOLOGRAPHIC STRIDE CHECK (BASE 2) ---
            
            // 1. Calculate Universal Start Point (Inverse of 2 mod P)
            //    Start = (P^2 + 1) / 2
            //    Start % P = (P+1)/2
            const inv2 = (P + 1n) / 2n;

            // 2. Calculate the Index of our Mersenne Number (mod P)
            //    N = 2^q - 1
            //    Index I = (N+1)/2 = 2^(q-1)
            //    We calculate 2^(q-1) % P using fast modular exponentiation
            const Index_mod_P = powMod(2n, q - 1n, P);

            // 3. The Collision Check
            if (Index_mod_P === inv2) {
                postMessage({ type: 'hit', p: Number(P) });
            }
            
            processed++;
            if(processed % 1000 === 0) {
                postMessage({ type: 'progress', pct: (processed/total)*100 });
            }
        }
        
        postMessage({ type: 'done' });

    } catch(err) {
        postMessage({ type: 'error', msg: err.message });
    }
};
`;

function log(msg, type='') {
    const box = document.getElementById('logBox');
    const div = document.createElement('div');
    div.textContent = `> ${msg}`;
    if(type === 'hit') div.className = 'hit';
    if(type === 'safe') div.className = 'safe';
    if(type === 'sys') div.className = 'sys';
    box.prepend(div);
}

function startScan() {
    if(workers.length > 0) return;
    
    const qVal = document.getElementById('inpExp').value;
    const startVal = parseInt(document.getElementById('inpStart').value);
    const endVal = parseInt(document.getElementById('inpEnd').value);
    const coreCount = parseInt(document.getElementById('inpCores').value);

    document.getElementById('btnStart').style.display = 'none';
    document.getElementById('btnStop').style.display = 'block';
    document.getElementById('logBox').innerHTML = '';
    document.getElementById('coresContainer').innerHTML = '';
    document.getElementById('sTarget').textContent = `2^${qVal} - 1`;
    document.getElementById('sStatus').textContent = "SCANNING...";
    document.getElementById('sStatus').style.color = "#38bdf8";

    log(`Deploying Fleet for Mersenne 2^${qVal}-1`, 'sys');
    log(`Index Logic: I = 2^(${qVal}-1)`, 'sys');

    const range = endVal - startVal;
    const rangePerCore = Math.ceil(range / coreCount);
    activeWorkers = coreCount;

    const blob = new Blob([workerCode], {type: 'application/javascript'});
    const workerUrl = URL.createObjectURL(blob);

    for(let i=0; i<coreCount; i++) {
        const wStart = startVal + (i * rangePerCore);
        const wEnd = Math.min(wStart + rangePerCore, endVal);
        
        const coreDiv = document.createElement('div');
        coreDiv.className = 'core-row core-active';
        coreDiv.innerHTML = `
            <div class="core-header">
                <span>UNIT ${i+1} [Search: ${wStart} - ${wEnd}]</span>
                <span id="progText-${i}">0%</span>
            </div>
            <div class="progress-bg"><div id="progBar-${i}" class="progress-fill"></div></div>
        `;
        document.getElementById('coresContainer').appendChild(coreDiv);

        const w = new Worker(workerUrl);
        w.onmessage = function(e) { handleMessage(e.data, i); };
        w.postMessage({ qStr: qVal, startStr: wStart.toString(), endStr: wEnd.toString(), workerId: i });
        workers.push(w);
    }
}

function handleMessage(data, id) {
    if(data.type === 'progress') {
        document.getElementById(`progBar-${id}`).style.width = data.pct + '%';
        document.getElementById(`progText-${id}`).textContent = Math.round(data.pct) + '%';
    }
    else if(data.type === 'hit') {
        log(`UNIT ${id+1} FOUND FACTOR: ${data.p}`, 'hit');
        log(`Confirmed: 2^${document.getElementById('inpExp').value}-1 is divisible by ${data.p}`, 'hit');
    }
    else if(data.type === 'done') {
        document.getElementById(`progBar-${id}`).style.width = '100%';
        document.getElementById(`progText-${id}`).textContent = 'DONE';
        document.getElementById(`progBar-${id}`).style.backgroundColor = '#22c55e';
        activeWorkers--;
        if(activeWorkers <= 0) {
            document.getElementById('sStatus').textContent = "SCAN COMPLETE";
            document.getElementById('sStatus').style.color = "#22c55e";
            log("Fleet returned to dock.", 'safe');
            stopScan();
        }
    }
}

function stopScan() {
    workers.forEach(w => w.terminate());
    workers = [];
    document.getElementById('btnStart').style.display = 'block';
    document.getElementById('btnStop').style.display = 'none';
}
</script>
</body>
</html>
