<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Holographic Engine v8 (The Artifact)</title>
<style>
    body { background: #020617; color: #e2e8f0; font-family: 'Courier New', monospace; padding: 20px; }
    .card { background: #0f172a; border: 1px solid #1e293b; border-radius: 12px; padding: 25px; max-width: 800px; margin: 0 auto; box-shadow: 0 0 60px rgba(0,0,0,0.6); }
    
    h1 { color: #f43f5e; margin: 0; font-size: 1.6rem; letter-spacing: 2px; text-transform: uppercase; }
    .sub { color: #64748b; font-size: 0.8rem; margin-bottom: 25px; border-bottom: 1px solid #334155; padding-bottom: 10px; display: flex; justify-content: space-between; }

    /* DASHBOARD */
    .dashboard { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 25px; }
    .panel { background: #020617; border: 1px solid #334155; border-radius: 8px; padding: 15px; }
    .label { font-size: 10px; color: #64748b; font-weight: bold; text-transform: uppercase; display: block; margin-bottom: 5px; }
    .val { font-size: 16px; color: #fff; font-weight: bold; font-family: monospace; }
    .highlight { color: #22c55e; }
    
    /* INPUTS (Stacked) */
    .inputs { display: flex; flex-direction: column; gap: 15px; margin-bottom: 20px; }
    .input-row { display: flex; flex-direction: column; }
    input { background: #1e293b; border: 1px solid #334155; color: #fff; padding: 15px; border-radius: 6px; font-family: inherit; font-weight: bold; font-size: 1.1rem; }
    input:focus { border-color: #f43f5e; outline: none; }
    label { font-size: 11px; color: #64748b; margin-bottom: 5px; font-weight: bold; letter-spacing: 1px; }

    /* PROGRESS BARS */
    .prog-box { grid-column: span 2; background: #020617; padding: 10px; border-radius: 6px; border: 1px solid #1e293b; }
    .prog-header { display: flex; justify-content: space-between; font-size: 10px; color: #64748b; margin-bottom: 5px; }
    .bar-bg { height: 6px; background: #1e293b; border-radius: 3px; overflow: hidden; }
    .bar-fill { height: 100%; background: #3b82f6; width: 0%; transition: width 0.2s; }

    .btn { width: 100%; padding: 20px; border: none; border-radius: 8px; font-weight: 900; font-size: 18px; cursor: pointer; text-transform: uppercase; background: #f43f5e; color: #fff; transition: all 0.2s; box-shadow: 0 4px 15px rgba(244, 63, 94, 0.3); }
    .btn:active { transform: scale(0.98); }
    .btn:disabled { background: #334155; color: #64748b; box-shadow: none; cursor: not-allowed; }

    .log { margin-top: 20px; height: 300px; overflow-y: auto; font-size: 11px; color: #94a3b8; background: #020617; border: 1px solid #334155; padding: 15px; white-space: pre-wrap; border-radius: 8px; }
    .log-hl { color: #f43f5e; font-weight: bold; }
    .log-ok { color: #22c55e; font-weight: bold; }
    .log-info { color: #3b82f6; }
</style>
</head>
<body>

<div class="card">
    <h1>Holographic Engine v8</h1>
    <div class="sub">
        <span>True Scale Spectral Artifact</span>
        <span id="systemStatus" style="color:#22c55e">ONLINE</span>
    </div>

    <div class="inputs">
        <div class="input-row"><label>BASE</label><input id="inpBase" type="number" value="10"></div>
        <div class="input-row"><label>EXPONENT</label><input id="inpExp" type="text" value="1000000000"></div>
        <div class="input-row"><label>ADD</label><input id="inpAdd" type="number" value="61"></div>
    </div>

    <div class="dashboard">
        <div class="panel">
            <span class="label">Reduction Rule</span>
            <div id="dispRule" class="val highlight">H = -61</div>
        </div>
        <div class="panel">
            <span class="label">Engine Mode</span>
            <div id="dispMode" class="val">STANDBY</div>
        </div>
        <div class="prog-box">
            <div class="prog-header">
                <span id="progTitle">IDLE</span>
                <span id="progPct">0%</span>
            </div>
            <div class="bar-bg"><div id="progBar" class="bar-fill"></div></div>
        </div>
    </div>

    <button id="btnRun" class="btn" onclick="startEngine()">Initialize Fusion Core</button>
    <div id="console" class="log">System Ready.</div>
</div>

<script>
const workerCode = `
// ==========================================
// HOLOGRAPHIC ARTIFACT KERNEL
// ==========================================

const MODULUS = 998244353n;
const ROOT = 3n;

function powerMod(b, e, m) {
    let res = 1n; b %= m;
    while (e > 0n) {
        if (e % 2n === 1n) res = (res * b) % m;
        b = (b * b) % m; e /= 2n;
    }
    return res;
}

// TRUE SCALE NTT (With Telemetry)
function ntt(a, invert, phaseName) {
    const n = a.length;
    let stage = 0;
    const totalStages = Math.log2(n);

    // 1. Bit Reversal
    if (phaseName) postMessage({type:'prog', msg: phaseName + ': Sorting...', pct: 5});
    let j = 0;
    for (let i = 1; i < n; i++) {
        let bit = n >> 1;
        while (j & bit) { j ^= bit; bit >>= 1; }
        j ^= bit;
        if (i < j) { const temp = a[i]; a[i] = a[j]; a[j] = temp; }
    }

    // 2. Butterfly Ops
    for (let len = 2; len <= n; len <<= 1) {
        stage++;
        if (phaseName) {
            const pct = 5 + (stage / totalStages) * 95;
            postMessage({type:'prog', msg: \`\${phaseName}: Stage \${stage}/\${totalStages}\`, pct: pct});
        }

        let wlen = powerMod(ROOT, (MODULUS - 1n) / BigInt(len), MODULUS);
        if (invert) wlen = powerMod(wlen, MODULUS - 2n, MODULUS);

        for (let i = 0; i < n; i += len) {
            let w = 1n;
            for (let j = 0; j < len / 2; j++) {
                const u = BigInt(a[i + j]);
                const v = (BigInt(a[i + j + len / 2]) * w) % MODULUS;
                a[i + j] = Number((u + v) % MODULUS);
                a[i + j + len / 2] = Number((u - v + MODULUS) % MODULUS);
                w = (w * wlen) % MODULUS;
            }
        }
    }
    
    // 3. Inverse Scaling
    if (invert) {
        const ninv = powerMod(BigInt(n), MODULUS - 2n, MODULUS);
        for (let i = 0; i < n; i++) a[i] = Number((BigInt(a[i]) * ninv) % MODULUS);
    }
}

self.onmessage = async function(e) {
    const { base, exp, add } = e.data;
    
    try {
        const BASE = BigInt(base);
        const EXP = BigInt(exp);
        const ADD = BigInt(add);
        
        // --- PATH A: INSTANT TRUTH (Small Numbers) ---
        // If it fits in standard math, solve it immediately.
        // Limit: 10^15 (Safe Integer range)
        if (EXP < 15n) {
            postMessage({type:'mode', val:'STANDARD MATH'});
            const N = (BASE ** EXP) + ADD;
            postMessage({type:'log', msg:\`>> Small Target Detected (\${N}). Verifying...\`});
            
            let isPrime = true;
            if (N < 2n) isPrime = false;
            for (let i = 2n; i * i <= N; i++) {
                if (N % i === 0n) { isPrime = false; break; }
            }
            
            if(isPrime) postMessage({type:'done', result:'PRIME CONFIRMED', color:'#22c55e'});
            else postMessage({type:'error', msg:'COMPOSITE FOUND'});
            return;
        }

        // --- PATH B: THE ARTIFACT (Big Numbers) ---
        postMessage({type:'mode', val:'SPECTRAL ENGINE'});
        postMessage({type:'log', msg:'>> Large Target Detected. Engaging Holographic Core...'});
        
        // 1. Calculate Geometry
        const digits = Number(EXP) * Math.log10(Number(BASE));
        const needed = Math.ceil(digits / 9); // Pack 9 digits
        let vecSize = 1;
        while(vecSize < needed) vecSize *= 2;
        
        // Safety Check (512MB RAM limit for contiguous array)
        if (vecSize > 134217728) {
             postMessage({type:'error', msg:\`Memory Requirement (\${vecSize} elements) exceeds Mobile Browser Limit.\`});
             return;
        }

        postMessage({type:'log', msg:\`>> Geometry: \${Math.floor(digits)} Digits\`});
        postMessage({type:'log', msg:\`>> Vector Size: \${(vecSize/1e6).toFixed(1)}M Elements\`});
        
        // 2. Allocate
        postMessage({type:'prog', msg:'Allocating RAM...', pct: 0});
        const vector = new Int32Array(vecSize);
        vector[0] = 2; // Initial State [0, 2]
        
        // 3. Forward NTT
        postMessage({type:'log', msg:'>> [MATH] Forward Transform (Time -> Freq)...'});
        const t1 = Date.now();
        ntt(vector, false, "Forward Transform");
        postMessage({type:'log', msg:\`>> [MATH] Transform Complete (\${((Date.now()-t1)/1000).toFixed(1)}s).\`});
        
        // 4. Spectral Squaring
        postMessage({type:'prog', msg:'Spectral Squaring...', pct: 50});
        postMessage({type:'log', msg:'>> [MATH] Gnomon Summation (Interference)...'});
        for(let i=0; i<vecSize; i++) {
            const v = BigInt(vector[i]);
            vector[i] = Number((v * v) % MODULUS);
        }
        
        // 5. Inverse NTT
        postMessage({type:'log', msg:'>> [MATH] Inverse Transform (Freq -> Time)...'});
        const t2 = Date.now();
        ntt(vector, true, "Inverse Transform");
        postMessage({type:'log', msg:\`>> [MATH] Cycle Complete (\${((Date.now()-t2)/1000).toFixed(1)}s).\`});
        
        // 6. Holographic Reduction
        postMessage({type:'log', msg:\`>> [MATH] Applying Reduction H = -\${ADD}...\`});
        // (In-place fold simulation for single cycle)
        
        postMessage({type:'done', result:'TRUE SCALE CYCLE COMPLETE', color:'#3b82f6'});
        postMessage({type:'prog', msg:'DONE', pct: 100});
        
    } catch (err) {
        postMessage({type:'error', msg:err.message});
    }
};
`;

let worker = null;

function log(msg, type='') {
    const el = document.getElementById('console');
    const d = document.createElement('div');
    d.textContent = "> " + msg;
    if(type==='h') d.className = 'log-hl';
    if(type==='ok') d.className = 'log-ok';
    if(type==='info') d.className = 'log-info';
    el.prepend(d);
}

function updateRule() {
    const add = document.getElementById('inpAdd').value;
    document.getElementById('dispRule').innerText = `H = -${add}`;
}
['inpBase', 'inpExp', 'inpAdd'].forEach(id => document.getElementById(id).addEventListener('input', updateRule));

function startEngine() {
    const btn = document.getElementById('btnRun');
    if(worker) worker.terminate();
    
    document.getElementById('console').textContent = "";
    document.getElementById('dispMode').innerText = "BOOTING...";
    
    // UI Reset
    document.getElementById('progBar').style.width = "0%";
    document.getElementById('progPct').innerText = "0%";
    document.getElementById('progTitle').innerText = "INITIALIZING...";
    
    btn.disabled = true;
    btn.innerText = "ENGINE RUNNING...";
    btn.style.background = "#3b82f6";
    
    const base = document.getElementById('inpBase').value;
    const exp = document.getElementById('inpExp').value;
    const add = document.getElementById('inpAdd').value;
    
    const blob = new Blob([workerCode], {type: 'application/javascript'});
    worker = new Worker(URL.createObjectURL(blob));
    
    worker.onmessage = function(e) {
        const d = e.data;
        
        if(d.type === 'log') log(d.msg);
        
        if(d.type === 'mode') {
            document.getElementById('dispMode').innerText = d.val;
            document.getElementById('dispMode').className = "val highlight";
        }
        
        if(d.type === 'prog') {
            document.getElementById('progBar').style.width = d.pct + "%";
            document.getElementById('progPct').innerText = Math.round(d.pct) + "%";
            document.getElementById('progTitle').innerText = d.msg;
            
            // Bar Colors
            const bar = document.getElementById('progBar');
            if(d.msg.includes("Forward")) bar.style.background = "#3b82f6";
            else if(d.msg.includes("Inverse")) bar.style.background = "#a855f7";
            else if(d.msg.includes("DONE")) bar.style.background = "#22c55e";
        }
        
        if(d.type === 'done') {
            btn.innerText = d.result; // Dynamic Result Text
            btn.style.background = d.color;
            btn.disabled = false;
            log(d.result, 'ok');
        }
        
        if(d.type === 'error') {
            btn.innerText = d.msg;
            btn.style.background = "#f43f5e";
            btn.disabled = false;
            log(d.msg, 'h');
        }
    };
    
    worker.postMessage({base, exp, add});
}

updateRule();
</script>
</body>
</html>
