<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Factor Hunter: Odd Stack</title>
    <style>
        body {
            background-color: #121212;
            color: #e0e0e0;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        h1 { color: #00e676; margin-bottom: 10px; text-align: center; }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: #1e1e1e;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid #333;
        }

        input {
            padding: 12px;
            background: #333;
            border: 1px solid #555;
            color: white;
            border-radius: 8px;
            width: 80px;
            font-size: 1.2rem;
            text-align: center;
        }

        button {
            padding: 12px 20px;
            background: #00e676;
            color: #000;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
        }

        #canvas-container {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: auto;
            width: 100%;
        }

        canvas {
            border: 1px solid #333;
            background: #181818;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        .status {
            margin-top: 15px;
            text-align: center;
            font-size: 1rem;
            min-height: 50px;
        }
        .highlight { color: #00e676; font-weight: bold; }
        .fail { color: #ff5252; }
    </style>
</head>
<body>

    <h1>Odd Stack Hunter</h1>

    <div class="controls">
        <button onclick="changeRows(-1)">- Row</button>
        <div style="display:flex; flex-direction:column; align-items:center;">
             <span style="font-size:0.8rem; color:#888;">Number</span>
             <input type="number" id="targetNum" value="15">
        </div>
        <button onclick="changeRows(1)">+ Row</button>
    </div>

    <div class="status" id="statusMsg">
        Target: 15
    </div>

    <div id="canvas-container">
        <canvas id="mainCanvas"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        const input = document.getElementById('targetNum');
        const statusMsg = document.getElementById('statusMsg');

        let target = 15;
        let rowCount = 1;

        function changeRows(delta) {
            rowCount += delta;
            if (rowCount < 1) rowCount = 1;
            draw();
        }

        input.addEventListener('change', () => {
            target = parseInt(input.value) || 15;
            rowCount = 1; // Reset rows on number change
            draw();
        });

        function draw() {
            target = parseInt(input.value) || 15;
            
            // 1. Math: Can we make 'target' from 'rowCount' consecutive odds?
            // Sum of k consecutive odds starting at 'a' (where a is odd)
            // Sum = k * (a + k - 1)
            // Or simpler: Average value = Target / Rows.
            // If rows is odd, Average must be an integer (odd).
            // If rows is even, Average must be xx.5 (even sum).
            // Actually, simpler geometric rule:
            // Middle Value = Target / RowCount.
            // First Term = Middle - (RowCount - 1).
            
            // We just need to find the STARTING odd number.
            // Sum = rowCount * start + rowCount^2 - rowCount ? No.
            // Let the sequence be x, x+2, x+4...
            // Sum = rowCount*x + (0 + 2 + ... + 2(rowCount-1))
            // Sum = rowCount*x + rowCount*(rowCount-1)
            // target = rowCount * x + rowCount^2 - rowCount
            // rowCount * x = target - (rowCount^2 - rowCount)
            
            const remainder = target - (rowCount*rowCount - rowCount);
            let startNum = remainder / rowCount;
            let isInteger = Number.isInteger(startNum);
            let isOdd = (startNum % 2 !== 0);
            
            let success = (isInteger && isOdd && startNum > 0);
            
            // 2. Setup Visuals
            const blockSize = 30;
            const gap = 2;
            const padding = 40;
            
            // Calculate dimensions based on the hypothetical stack
            // (Even if it fails, we draw the "attempt")
            
            // If failure, we just guess a startNum to show the mismatch?
            // Let's force startNum to be the closest odd integer to visualize the error.
            if (!success) {
                // Approximate
                let approx = Math.round(startNum);
                if (approx % 2 === 0) approx -= 1; // Make it odd
                if (approx < 1) approx = 1;
                startNum = approx;
            }

            const maxRowWidth = startNum + (rowCount - 1) * 2;
            const totalWidthPx = (maxRowWidth * (blockSize + gap)) + padding * 2;
            const totalHeightPx = (rowCount * (blockSize + gap)) + padding * 2;

            const dpr = window.devicePixelRatio || 1;
            canvas.style.width = totalWidthPx + 'px';
            canvas.style.height = totalHeightPx + 'px';
            canvas.width = totalWidthPx * dpr;
            canvas.height = totalHeightPx * dpr;
            ctx.scale(dpr, dpr);
            
            ctx.clearRect(0, 0, totalWidthPx, totalHeightPx);

            // 3. Draw Stack
            let currentSum = 0;
            let currentOdd = startNum;
            const startX = padding;
            const startY = padding;

            for (let r = 0; r < rowCount; r++) {
                // Center the row?
                // A true trapezoid stack is centered.
                // The max width is the bottom row.
                // Center offset = (MaxWidth - CurrentWidth) / 2
                
                const rowWidthPx = currentOdd * (blockSize + gap) - gap;
                const maxRowPx = maxRowWidth * (blockSize + gap) - gap;
                const xOffset = (maxRowPx - rowWidthPx) / 2;

                for (let c = 0; c < currentOdd; c++) {
                    ctx.fillStyle = success ? '#00e676' : '#555'; // Green if perfect, Grey if fail
                    ctx.fillRect(
                        startX + xOffset + c * (blockSize + gap),
                        startY + r * (blockSize + gap),
                        blockSize, blockSize
                    );
                }
                
                // Draw numbers
                ctx.fillStyle = '#fff';
                ctx.font = '12px monospace';
                ctx.textAlign = 'right';
                ctx.fillText(currentOdd, startX - 10, startY + r * (blockSize + gap) + 20);

                currentSum += currentOdd;
                currentOdd += 2;
            }

            // 4. Status Message
            if (success && currentSum === target) {
                // Calculate Factors from the shape
                // Factor 1 = Row Count
                // Factor 2 = Average Width = Sum / Count
                const f1 = rowCount;
                const f2 = target / rowCount;
                
                statusMsg.innerHTML = `
                    <span class="highlight">MATCH!</span> Sum is ${currentSum}.<br>
                    Stack: <span class="highlight">${rowCount}</span> rows.<br>
                    Mean Width: <span class="highlight">${f2}</span>.<br>
                    Factors: <span class="highlight">${f1} &times; ${f2} = ${target}</span>
                `;
            } else {
                const diff = target - currentSum;
                statusMsg.innerHTML = `
                    <span class="fail">MISS.</span> Sum is ${currentSum} (Target: ${target}).<br>
                    Off by ${diff}. Try a different number of rows.
                `;
            }
        }

        // Init
        draw();

    </script>
</body>
</html>
