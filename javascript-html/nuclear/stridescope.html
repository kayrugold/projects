<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stride Scope v2: The Translator</title>
<style>
    body { background: #0f0f0f; color: #eee; font-family: 'Courier New', monospace; padding: 10px; margin: 0; }
    
    /* THE INFO PANEL (Fixed at top for easy reading on phone) */
    .info-panel {
        background: #1a1a1a;
        border-bottom: 2px solid #a78bfa;
        padding: 15px;
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        display: flex;
        flex-direction: column;
        gap: 5px;
    }
    
    .info-title { font-size: 10px; color: #888; text-transform: uppercase; letter-spacing: 1px; }
    .info-main { font-size: 1.2rem; font-weight: bold; color: #fff; }
    .info-sub { font-size: 0.9rem; color: #a78bfa; }
    
    /* CONTROLS */
    .controls { padding: 15px; background: #111; border-bottom: 1px solid #333; display: flex; gap: 10px; align-items: center; }
    input { background: #222; border: 1px solid #444; color: #fff; padding: 8px; width: 80px; text-align: center; }
    .btn { padding: 8px 15px; background: #a78bfa; color: #000; border: none; font-weight: bold; cursor: pointer; border-radius: 4px; }
    
    /* TAPE */
    .tape-container {
        display: flex;
        overflow-x: auto;
        padding: 20px 0;
        min-height: 200px;
    }
    
    .col {
        min-width: 45px;
        border-right: 1px solid #222;
        display: flex;
        flex-direction: column;
        align-items: center;
        cursor: pointer;
        transition: background 0.1s;
    }
    .col:active { background: #333; }
    .col.selected { background: #2a2a2a; border-right: 1px solid #666; }
    
    .cell-idx { font-size: 10px; color: #555; padding: 5px; width: 100%; text-align: center; border-bottom: 1px solid #333; }
    
    .cell-walker {
        height: 25px;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 9px;
        color: #000;
        font-weight: bold;
        border-bottom: 1px dashed #1a1a1a;
    }
    
    .cell-result {
        height: 35px;
        width: 100%;
        margin-top: auto;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 10px;
        border-top: 2px solid #333;
    }
    
    /* COLORS */
    .empty { opacity: 0.05; }
    .hit-3 { background-color: #fca5a5; } 
    .hit-5 { background-color: #86efac; } 
    .hit-7 { background-color: #93c5fd; } 
    .hit-11 { background-color: #fde047; } 
    
    .res-safe { background-color: #22c55e; color: #000; } 
    .res-hit { background-color: #ef4444; color: #fff; } 
    .res-sync { background-color: #7f1d1d; color: #fff; border: 2px solid #ff0000; } 
</style>
</head>
<body>

<div class="info-panel">
    <div class="info-title">Status Monitor</div>
    <div id="dispMain" class="info-main">Tap a Column...</div>
    <div id="dispSub" class="info-sub">Waiting for input</div>
</div>

<div class="controls">
    <label style="color:#666; font-size:12px;">Max Index:</label>
    <input id="inpMax" type="number" value="50">
    <button class="btn" onclick="drawTape()">Render</button>
</div>

<div id="tape" class="tape-container"></div>

<script>
// --- MATH ENGINE ---
function getStart(p) { return (p*p + 1) / 2; }
function getRealNumber(idx) { return (2 * idx) - 1; }

// --- UI ENGINE ---
let selectedCol = null;

function showDetails(idx, hitCount, hitBy) {
    // 1. Calculate Real Number
    const realNum = getRealNumber(idx);
    
    // 2. Update Panel
    const dispMain = document.getElementById('dispMain');
    const dispSub = document.getElementById('dispSub');
    
    // Highlight Text Logic
    let statusText = "";
    if (hitCount === 0) {
        statusText = `<span style="color:#22c55e">PRIME GAP</span>`;
        dispSub.innerHTML = `No walkers stepped here.`;
    } else {
        statusText = `<span style="color:#ef4444">COMPOSITE</span>`;
        dispSub.innerHTML = `Hit by Families: [ ${hitBy.join(', ')} ]`;
    }

    dispMain.innerHTML = `Index ${idx} = Number ${realNum} &nbsp; ${statusText}`;
    
    // 3. Highlight Column UI
    if (selectedCol) selectedCol.classList.remove('selected');
    const newCol = document.getElementById(`col-${idx}`);
    if (newCol) {
        newCol.classList.add('selected');
        selectedCol = newCol;
    }
}

function drawTape() {
    const max = parseInt(document.getElementById('inpMax').value);
    const container = document.getElementById('tape');
    container.innerHTML = '';
    
    const primes = [3, 5, 7, 11, 13, 17, 19, 23];
    
    for (let i = 1; i <= max; i++) {
        const col = document.createElement('div');
        col.className = 'col';
        col.id = `col-${i}`;
        
        // --- 1. INDEX HEADER ---
        const idxBox = document.createElement('div');
        idxBox.className = 'cell-idx';
        idxBox.textContent = i;
        col.appendChild(idxBox);

        let hitCount = 0;
        let hitBy = [];

        // --- 2. WALKERS ---
        primes.forEach(p => {
            const start = getStart(p);
            const box = document.createElement('div');
            box.className = 'cell-walker';
            
            if (i >= start && (i - start) % p === 0) {
                // HIT
                box.textContent = p;
                box.classList.add(`hit-${p}`);
                if(!box.classList.length > 2) box.style.background = '#ccc';
                hitCount++;
                hitBy.push(p);
            } else {
                box.textContent = "";
                box.classList.add('empty');
            }
            col.appendChild(box);
        });

        // --- 3. RESULT FOOTER ---
        const resBox = document.createElement('div');
        resBox.className = 'cell-result';
        
        if (hitCount === 0) {
            resBox.className += ' res-safe';
            resBox.textContent = "GAP";
        } else if (hitCount === 1) {
            resBox.className += ' res-hit';
            resBox.textContent = "X";
        } else {
            resBox.className += ' res-sync';
            resBox.textContent = hitCount + "X";
        }
        col.appendChild(resBox);

        // --- 4. CLICK HANDLER ---
        // Capture the current state variables for the click
        col.onclick = function() { showDetails(i, hitCount, hitBy); };

        container.appendChild(col);
    }
}

// Start
drawTape();
</script>
</body>
</html>
