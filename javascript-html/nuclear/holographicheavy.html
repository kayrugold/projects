<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Holographic Heavy Lifter (1GB Alloc)</title>
<style>
    body { background: #000; color: #e2e8f0; font-family: 'Courier New', monospace; padding: 15px; }
    .card { background: #111; border: 1px solid #333; border-radius: 12px; padding: 20px; box-shadow: 0 0 20px rgba(147, 51, 234, 0.2); }
    h1 { color: #a855f7; margin: 0 0 10px 0; text-transform: uppercase; letter-spacing: 2px; font-size: 1.2rem; }
    
    .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
    .stat-box { background: #222; padding: 10px; border-radius: 8px; border: 1px solid #333; }
    .stat-label { font-size: 10px; color: #888; text-transform: uppercase; display: block; margin-bottom: 5px; }
    .stat-val { font-size: 14px; font-weight: bold; color: #fff; }
    .mem-bar { height: 6px; background: #333; margin-top: 5px; border-radius: 3px; overflow: hidden; }
    .mem-fill { height: 100%; background: #a855f7; width: 0%; transition: width 0.2s; }
    
    .btn { width: 100%; padding: 15px; border: none; border-radius: 8px; font-weight: bold; font-size: 16px; cursor: pointer; text-transform: uppercase; background: #a855f7; color: white; }
    .btn:disabled { background: #444; color: #888; cursor: not-allowed; }
    
    .log { margin-top: 20px; height: 200px; overflow-y: auto; background: #050505; border: 1px solid #333; padding: 10px; font-size: 11px; color: #d8b4fe; white-space: pre-wrap; font-family: monospace; }
</style>
</head>
<body>

<div class="card">
    <h1>Holographic Heavy Lifter</h1>
    <div style="color: #64748b; font-size: 12px; margin-bottom: 20px;">
        Virtual Memory Manager â€¢ Vector Allocation
    </div>

    <div class="stat-grid">
        <div class="stat-box">
            <span class="stat-label">Target Exponent</span>
            <span class="stat-val">1,000,000,000</span>
        </div>
        <div class="stat-box">
            <span class="stat-label">Memory Required</span>
            <span class="stat-val">~1.0 GB</span>
        </div>
    </div>
    
    <div class="stat-box" style="margin-bottom: 20px;">
        <span class="stat-label">Allocation Status (Virtual Pages)</span>
        <div class="mem-bar"><div id="memBar" class="mem-fill"></div></div>
        <div id="memText" style="text-align: right; font-size: 10px; color: #888; margin-top: 5px;">0 / 4096 Pages</div>
    </div>

    <button id="btnRun" class="btn" onclick="startSystem()">Initialize 10^9 Vector</button>
    <div id="console" class="log">System Ready.</div>
</div>

<script>
const workerCode = `
// --- VIRTUAL MEMORY MANAGER (From Factor Hunter v8.3) ---
const PAGE_ELEMENTS = 16 * 1024 * 1024; // 16M Elements (64MB) per page for safety
// Note: Integers are 4 bytes. 16M * 4 = 64MB. 
// 10^9 Digits need ~1GB. 
// Total Pages needed: ~16.

class VirtualArray {
    constructor(totalSize) {
        this.totalSize = totalSize;
        this.pages = [];
        this.numPages = Math.ceil(totalSize / PAGE_ELEMENTS);
        this.allocated = 0;
    }

    async allocate() {
        for(let i=0; i<this.numPages; i++) {
            const size = (i === this.numPages-1) ? (this.totalSize % PAGE_ELEMENTS) || PAGE_ELEMENTS : PAGE_ELEMENTS;
            try {
                // Allocate standard Int32Array (4 bytes per digit/chunk)
                this.pages.push(new Int32Array(size));
                this.allocated++;
                
                // Report every few pages
                postMessage({
                    type: 'progress', 
                    pages: this.allocated, 
                    total: this.numPages,
                    mb: (this.allocated * 64)
                });
                
                // Yield to prevent UI freeze
                if(i % 2 === 0) await new Promise(r => setTimeout(r, 10));
                
            } catch(e) {
                throw new Error(\`Alloc Failed Page \${i}: \${e.message}\`);
            }
        }
    }
    
    // Set a value at global index
    set(index, value) {
        const pIdx = (index / PAGE_ELEMENTS) | 0;
        const offset = index % PAGE_ELEMENTS;
        this.pages[pIdx][offset] = value;
    }
    
    // Get a value
    get(index) {
        const pIdx = (index / PAGE_ELEMENTS) | 0;
        const offset = index % PAGE_ELEMENTS;
        return this.pages[pIdx][offset];
    }
}

self.onmessage = async function(e) {
    if(e.data.cmd === 'init') {
        try {
            const EXP = 1_000_000_000;
            
            // We need two vectors: A and B.
            // Each represents a number up to 10^1,000,000,000.
            // That's 1 Billion Digits.
            
            postMessage({type:'log', msg: \`Requesting Virtual RAM for Vector A...\`});
            const vecA = new VirtualArray(EXP);
            await vecA.allocate();
            postMessage({type:'log', msg: \`Vector A [OK].\`});
            
            postMessage({type:'log', msg: \`Requesting Virtual RAM for Vector B...\`});
            const vecB = new VirtualArray(EXP);
            await vecB.allocate();
            postMessage({type:'log', msg: \`Vector B [OK].\`});
            
            // Initialization: 
            // State A = 0
            // State B = 2 (The starting value for Miller-Rabin test of base 2)
            
            vecA.set(0, 0); 
            vecB.set(0, 2); 
            
            postMessage({type:'log', msg: \`\\nSYSTEM LIVE.\`});
            postMessage({type:'log', msg: \`Vectors Initialized for 10^1,000,000,000.\`});
            postMessage({type:'log', msg: \`Holographic Reduction Rule: H = -61 Loaded.\`});
            postMessage({type:'log', msg: \`Ready for Arithmetic Instructions.\`});
            
            postMessage({type:'done'});
            
        } catch(err) {
            postMessage({type:'error', msg: err.message});
        }
    }
};
`;

let worker = null;

function log(msg) {
    const el = document.getElementById('console');
    el.textContent += "> " + msg + "\n";
    el.scrollTop = el.scrollHeight;
}

function startSystem() {
    document.getElementById('btnRun').disabled = true;
    document.getElementById('console').textContent = "";
    log("Spinning up Worker Thread...");
    
    const blob = new Blob([workerCode], {type: 'application/javascript'});
    worker = new Worker(URL.createObjectURL(blob));
    
    worker.onmessage = function(e) {
        const d = e.data;
        if(d.type === 'log') log(d.msg);
        if(d.type === 'error') log("CRITICAL ERROR: " + d.msg);
        if(d.type === 'progress') {
            const pct = (d.pages / d.total) * 100;
            document.getElementById('memBar').style.width = pct + "%";
            document.getElementById('memText').innerText = `${d.pages} / ${d.total} Pages (${d.mb} MB)`;
        }
        if(d.type === 'done') {
            document.getElementById('btnRun').innerText = "VECTORS ALLOCATED";
            document.getElementById('memBar').style.backgroundColor = "#22c55e";
        }
    };
    
    worker.postMessage({cmd: 'init'});
}
</script>
</body>
</html>
