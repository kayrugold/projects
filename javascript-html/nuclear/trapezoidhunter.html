<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Factor Hunter: Trapezoid Scanner</title>
    <style>
        body {
            background-color: #121212;
            color: #e0e0e0;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 10px;
            min-height: 100vh;
        }
        
        h1 { color: #00e676; margin: 10px 0; text-align: center; font-size: 1.2rem; }
        
        .controls-container {
            background: #1e1e1e;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid #333;
            width: 100%;
            max-width: 500px;
            margin-bottom: 20px;
            box-sizing: border-box;
        }

        .row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        input[type="number"] {
            padding: 8px;
            background: #333;
            border: 1px solid #555;
            color: white;
            border-radius: 8px;
            width: 60px;
            font-size: 1.1rem;
            text-align: center;
            font-weight: bold;
        }

        button {
            padding: 10px 16px;
            background: #00e676;
            color: #000;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            flex-grow: 1;
            margin: 0 5px;
        }
        button.secondary {
            background: #333;
            color: #fff;
            border: 1px solid #555;
        }

        #canvas-wrapper {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: auto;
            width: 100%;
            margin-bottom: 20px;
        }

        canvas {
            /* border: 1px solid #333; */
        }

        .stats {
            text-align: center;
            font-size: 0.9rem;
            line-height: 1.5;
            min-height: 60px;
        }
        .highlight { color: #00e676; font-weight: bold; font-size: 1.1rem; }
        .white-txt { color: #888; }
        .fail { color: #ff5252; }
    </style>
</head>
<body>

    <h1>Trapezoid Scanner</h1>

    <div class="controls-container">
        <div class="row">
            <span>Target Number:</span>
            <input type="number" id="targetInput" value="15">
        </div>
        <div class="row">
            <button class="secondary" onclick="changeHeight(-1)">- Row</button>
            <span id="heightLabel">Height: 2</span>
            <button class="secondary" onclick="changeHeight(1)">+ Row</button>
        </div>
    </div>

    <div class="stats" id="statsBox"></div>

    <div id="canvas-wrapper">
        <canvas id="mainCanvas"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        const targetInput = document.getElementById('targetInput');
        const heightLabel = document.getElementById('heightLabel');
        const statsBox = document.getElementById('statsBox');

        let target = 15;
        let height = 2; // How many Green rows

        function changeHeight(delta) {
            height += delta;
            if (height < 1) height = 1;
            draw();
        }

        targetInput.addEventListener('change', () => {
            target = parseInt(targetInput.value) || 15;
            height = 2; // Reset
            draw();
        });

        function draw() {
            heightLabel.innerText = "Height: " + height;
            
            // MATH LOGIC
            // We want a Trapezoid of 'height' rows that sums to 'target'.
            // Area of Trapezoid = height * (top_width + bottom_width) / 2
            // Or: Sum = height * average_width
            // Average Width = target / height
            
            // Calculating the "Top Width" (the first green row width)
            // Let the sequence be x, x+1, x+2 ... up to x+(height-1)
            // Sum = height*x + (0+1+2...+height-1)
            // Sum = height*x + height*(height-1)/2
            // target = height*x + height*(height-1)/2
            
            // Solve for x (Top Green Width):
            // height*x = target - (height*(height-1)/2)
            // x = (target - triangular_number(height-1)) / height
            
            const triOffset = (height * (height - 1)) / 2;
            const remainder = target - triOffset;
            const topGreenWidth = remainder / height;
            
            const isInteger = Number.isInteger(topGreenWidth);
            const isValid = (topGreenWidth >= 1); // Width must be at least 1
            
            const success = isInteger && isValid;

            // Visual Setup
            // If failed, we just approximate to draw something
            let startWidth = success ? topGreenWidth : Math.max(1, Math.round(topGreenWidth));
            
            // "White Triangle" sits on top.
            // Its bottom row is width (startWidth - 1).
            // Its height is (startWidth - 1).
            const whiteHeight = Math.max(0, startWidth - 1);
            
            const totalRows = whiteHeight + height;
            const bottomWidth = startWidth + height - 1;
            
            // Rendering
            const blockSize = 30;
            const gap = 2;
            const totalH_px = (totalRows * (blockSize + gap)) + 40;
            const totalW_px = (bottomWidth * (blockSize + gap)) + 40;
            
            const dpr = window.devicePixelRatio || 1;
            canvas.style.width = totalW_px + 'px';
            canvas.style.height = totalH_px + 'px';
            canvas.width = totalW_px * dpr;
            canvas.height = totalH_px * dpr;
            ctx.scale(dpr, dpr);
            
            ctx.clearRect(0, 0, totalW_px, totalH_px);
            
            const startX = 20;
            const startY = 20;

            let currentSum = 0;

            // Draw White Triangle (Top)
            for (let r = 0; r < whiteHeight; r++) {
                const rowLen = r + 1;
                // Center alignment relative to bottom row?
                // Actually, let's left-align the staircase like your drawing
                // Your drawing was a right-angle triangle.
                // Let's stick to Right Triangle (Staircase) alignment.
                
                for (let c = 0; c < rowLen; c++) {
                    // Ghost blocks
                    const x = startX + c * (blockSize + gap);
                    const y = startY + r * (blockSize + gap);
                    
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.05)';
                    ctx.fillRect(x, y, blockSize, blockSize);
                    ctx.strokeStyle = '#333';
                    ctx.strokeRect(x, y, blockSize, blockSize);
                }
            }
            
            // Draw Green Trapezoid (Bottom)
            for (let r = 0; r < height; r++) {
                const rowLen = startWidth + r;
                const visualRowIndex = whiteHeight + r;
                
                for (let c = 0; c < rowLen; c++) {
                    const x = startX + c * (blockSize + gap);
                    const y = startY + visualRowIndex * (blockSize + gap);
                    
                    ctx.fillStyle = success ? '#00e676' : '#b71c1c'; // Green or Red
                    ctx.fillRect(x, y, blockSize, blockSize);
                    ctx.strokeStyle = '#000';
                    ctx.strokeRect(x, y, blockSize, blockSize);
                }
                currentSum += rowLen;
            }

            // Stats Update
            if (success) {
                statsBox.innerHTML = `
                    <span class="highlight">MATCH!</span><br>
                    <span style="color:#00e676">${height} rows</span> sum to ${target}.<br>
                    Green Stack: ${startWidth} + ... + ${bottomWidth}<br>
                    (White Space Top: T<sub>${whiteHeight}</sub>)
                `;
            } else {
                 statsBox.innerHTML = `
                    <span class="fail">NO FIT.</span><br>
                    ${height} rows can't sum to ${target}.<br>
                    Closest Sum: ${currentSum}
                `;
            }
        }

        // Init
        draw();

    </script>
</body>
</html>
