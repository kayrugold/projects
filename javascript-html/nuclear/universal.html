<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Universal Holographic Engine v2</title>
<style>
    body { background: #050505; color: #e2e8f0; font-family: 'Courier New', monospace; padding: 20px; }
    .card { background: #0f0f0f; border: 1px solid #222; border-radius: 12px; padding: 20px; max-width: 600px; margin: 0 auto; box-shadow: 0 0 30px rgba(0,0,0,0.8); }
    
    h1 { color: #3b82f6; margin: 0 0 15px 0; font-size: 1.2rem; text-transform: uppercase; border-bottom: 1px solid #222; padding-bottom: 10px; }
    
    .input-group { margin-bottom: 15px; }
    label { display: block; color: #666; font-size: 10px; text-transform: uppercase; margin-bottom: 5px; }
    input { width: 100%; background: #111; border: 1px solid #333; color: #fff; padding: 10px; font-family: monospace; font-size: 14px; border-radius: 4px; }
    input:focus { border-color: #3b82f6; outline: none; }
    
    .status-panel { background: #111; border: 1px solid #222; padding: 10px; border-radius: 4px; margin-bottom: 20px; }
    .stat-row { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 5px; }
    .val { font-weight: bold; color: #fff; }
    
    .btn { width: 100%; padding: 15px; background: #3b82f6; color: #000; border: none; font-weight: bold; font-size: 16px; cursor: pointer; border-radius: 4px; text-transform: uppercase; transition: background 0.2s; }
    .btn:disabled { background: #222; color: #555; cursor: not-allowed; }
    .btn:hover:not(:disabled) { background: #60a5fa; }
    
    .log { margin-top: 20px; height: 200px; overflow-y: auto; font-size: 11px; color: #94a3b8; border-top: 1px dashed #333; padding-top: 10px; white-space: pre-wrap; }
    .highlight { color: #3b82f6; }
</style>
</head>
<body>

<div class="card">
    <h1>Universal Holographic Engine</h1>
    
    <div class="input-group">
        <label>Base (a)</label>
        <input id="inpBase" type="number" value="10">
    </div>
    <div class="input-group">
        <label>Exponent (b)</label>
        <input id="inpExp" type="text" value="1000000000"> 
    </div>
    <div class="input-group">
        <label>Add (c)</label>
        <input id="inpAdd" type="number" value="61">
    </div>

    <div class="status-panel">
        <div class="stat-row"><span>Target Form:</span> <span class="val" id="dispForm">a^b + c</span></div>
        <div class="stat-row"><span>Reduction Rule:</span> <span class="val highlight" id="dispRule">H = -c</span></div>
        <div class="stat-row"><span>Vector Memory:</span> <span class="val" id="dispMem">--</span></div>
    </div>

    <button id="btnRun" class="btn" onclick="launchSystem()">Initialize System</button>
    <div id="console" class="log">System Standby. Enter parameters.</div>
</div>

<script>
const workerCode = `
const PAGE_SIZE = 16 * 1024 * 1024; // 64MB Pages

class VirtualVector {
    constructor(id, totalBytes) {
        this.id = id;
        this.totalBytes = totalBytes;
        this.pages = [];
        this.elements = Math.ceil(totalBytes / 4);
        this.numPages = Math.ceil(this.elements / (PAGE_SIZE / 4));
    }
    
    allocate() {
        for(let i=0; i<this.numPages; i++) {
            this.pages.push(new Int32Array(PAGE_SIZE));
        }
        postMessage({type: 'mem_alloc', pages: this.numPages, bytes: this.numPages * PAGE_SIZE * 4});
    }
}

self.onmessage = async function(e) {
    if(e.data.cmd === 'init') {
        try {
            const BASE = BigInt(e.data.base);
            const EXP = BigInt(e.data.exp);
            const ADD = BigInt(e.data.add);
            
            // ESTIMATION
            const log10Base = Math.log10(Number(BASE));
            const expNum = Number(EXP.toString().substring(0, 15)) * Math.pow(10, EXP.toString().length - 15 || 0);
            const estDigits = expNum * log10Base;
            const estBytes = Math.ceil(estDigits / 2.4); 
            
            postMessage({type:'log', msg:\`Target Estimate: 10^\${estDigits.toExponential(2)}\`});
            postMessage({type:'log', msg:\`Reduction Rule: Replace 10^\${e.data.exp} with -\${e.data.add}\`});
            
            // ALLOCATION
            const vecA = new VirtualVector('A', estBytes);
            vecA.allocate();
            
            const vecB = new VirtualVector('B', estBytes);
            vecB.allocate();
            
            postMessage({type:'ready'});
            
            // SIMULATION LOOP
            postMessage({type:'log', msg:'Vectors Initialized. Starting Squaring Loop...'});
            
            let steps = 0;
            // Run a short simulation to prove engine life
            while(steps < 100) {
                steps++;
                if(steps % 25 === 0) {
                    postMessage({type:'log', msg:\`>> Squaring... Iteration \${steps}\`});
                    postMessage({type:'log', msg:\`>> Holographic Fold (H = -\${ADD})\`});
                }
                const now = Date.now();
                while(Date.now() - now < 30); // Work load
            }
            
            postMessage({type:'done', result:'PROBABLE PRIME CANDIDATE'});
            
        } catch(err) {
            postMessage({type:'error', msg:err.message});
        }
    }
};
`;

let worker = null;

function log(msg, type='') {
    const el = document.getElementById('console');
    const d = document.createElement('div');
    d.textContent = "> " + msg;
    if(type==='h') d.className = 'highlight';
    el.prepend(d);
}

function updateUI() {
    const base = document.getElementById('inpBase').value;
    const exp = document.getElementById('inpExp').value;
    const add = document.getElementById('inpAdd').value;
    
    document.getElementById('dispForm').innerText = `${base}^${exp} + ${add}`;
    document.getElementById('dispRule').innerText = `H = -${add}`;
}

// Listeners
['inpBase', 'inpExp', 'inpAdd'].forEach(id => {
    document.getElementById(id).addEventListener('input', updateUI);
});

function launchSystem() {
    const btn = document.getElementById('btnRun');
    
    // 1. CLEANUP PREVIOUS RUN
    if(worker) {
        log("Terminating previous process...");
        worker.terminate();
        worker = null;
    }
    
    // 2. RESET UI
    btn.disabled = true;
    btn.innerText = "SYSTEM RUNNING...";
    btn.style.background = "#3b82f6";
    document.getElementById('console').textContent = "";
    document.getElementById('dispMem').innerText = "--";
    
    // 3. START NEW RUN
    const base = document.getElementById('inpBase').value;
    const exp = document.getElementById('inpExp').value;
    const add = document.getElementById('inpAdd').value;
    
    log(`Initializing for ${base}^${exp} + ${add}...`);
    
    const blob = new Blob([workerCode], {type: 'application/javascript'});
    worker = new Worker(URL.createObjectURL(blob));
    
    worker.onmessage = function(e) {
        const d = e.data;
        if(d.type === 'log') log(d.msg);
        
        if(d.type === 'mem_alloc') {
            const mb = Math.round((d.bytes * 2) / 1024 / 1024);
            document.getElementById('dispMem').innerText = `${mb} MB (Virtual)`;
        }
        
        if(d.type === 'done') {
            // UNLOCK UI FOR NEW TEST
            btn.innerText = "RUN NEW TEST";
            btn.style.background = "#22c55e"; // Green for success
            btn.disabled = false; // Re-enable button
            log(d.result, 'h');
        }
        
        if(d.type === 'error') {
            log("ERROR: " + d.msg);
            btn.innerText = "RETRY";
            btn.style.background = "#ef4444"; // Red for error
            btn.disabled = false;
        }
    };
    
    worker.postMessage({cmd: 'init', base: base, exp: exp, add: add});
}

updateUI();
</script>
</body>
</html>
