<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Geometric Pulse Engine (v0.1.1)</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/big-integer@1.6.48/BigInteger.min.js"></script>
    <style>
        :root {
            --bg: #050505;
            --main: #ffcc00; /* Gold */
            --sub: #00ffff;  /* Cyan */
            --dim: #333;
            --panel: #111;
            --text-dim: #666;
        }
        body {
            background: var(--bg); color: var(--main);
            font-family: 'Share Tech Mono', monospace;
            margin: 0; padding: 15px;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
            overflow-y: auto; overflow-x: hidden;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
        }
        
        h1 { margin: 0 0 15px 0; font-size:1.4rem; text-align:center; border-bottom: 2px solid var(--dim); padding-bottom: 10px; width: 100%; }

        /* INPUT SECTION */
        .controls { 
            width: 100%; display: flex; flex-direction: column; gap: 15px; margin-bottom: 20px; 
        }
        input { 
            padding: 15px; background: #1a1a1a; border: 1px solid var(--dim); 
            color: #fff; font-family: inherit; font-size: 1.1rem; text-align: center;
            border-radius: 4px; outline: none; width: 100%; box-sizing: border-box;
        }
        input:focus { border-color: var(--main); }
        button {
            padding: 15px; background: var(--main); color: #000; border: none;
            font-weight: bold; cursor: pointer; font-size: 1rem; border-radius: 4px;
            width: 100%;
        }
        button:active { transform: translateY(2px); }

        /* VISUALIZER */
        #vis-container {
            width: 100%; aspect-ratio: 1 / 1; max-width: 400px;
            background: #000; border: 1px solid var(--sub);
            margin-bottom: 15px; position: relative;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.05);
        }
        canvas { width: 100%; height: 100%; display: block; }
        .overlay-tag {
            position: absolute; top: 10px; left: 10px;
            background: rgba(0,0,0,0.7); color: var(--sub);
            padding: 4px 8px; font-size: 0.8rem; border: 1px solid var(--sub);
            pointer-events: none;
        }

        /* SLIDER */
        .slider-box {
            width: 100%; padding: 15px; box-sizing: border-box;
            border: 1px solid var(--dim); background: var(--panel);
            margin-bottom: 15px; text-align: center; border-radius: 4px;
        }
        input[type=range] { width: 100%; margin: 15px 0; cursor: pointer; accent-color: var(--sub); }
        .frame-info { display: flex; justify-content: space-between; font-size: 0.9rem; color: #888; }

        /* MATH STREAMS */
        .math-box {
            width: 100%; padding: 15px; box-sizing: border-box;
            background: #080808; margin-bottom: 10px;
            font-family: 'Courier New', monospace; font-size: 0.9rem;
            color: #aaa; border-left: 3px solid #333;
        }
        .math-box.active { border-left-color: var(--sub); }
        
        .chain-row { display: flex; justify-content: space-between; margin-bottom: 5px; border-bottom: 1px dashed #222; padding-bottom: 2px;}
        .chain-eq { color: #fff; }
        .chain-note { color: var(--sub); font-size: 0.8rem; }

        /* DNA LADDER */
        .dna-container {
            width: 100%; max-height: 150px; overflow-y: auto;
            background: #050505; border: 1px solid var(--dim);
            padding: 10px; box-sizing: border-box; margin-bottom: 20px;
            font-family: 'Courier New', monospace;
        }
        .dna-row {
            display: flex; justify-content: space-between;
            color: var(--text-dim); margin-bottom: 2px;
            font-size: 0.85rem;
        }
        .dna-row.highlight { color: var(--main); font-weight: bold; background: rgba(255, 204, 0, 0.1); }

        /* DASHBOARD */
        .dash-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; }
        .card {
            background: var(--panel); border: 1px solid var(--dim);
            padding: 15px 10px; text-align: center; border-radius: 4px;
            display: flex; flex-direction: column; justify-content: center;
        }
        .card.highlight { border-color: var(--sub); background: rgba(0, 255, 255, 0.05); }
        
        .lbl { font-size: 0.7rem; color: #888; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; }
        .val { font-size: 1.6rem; font-weight: bold; color: #fff; }
        .sub { font-size: 0.8rem; color: var(--main); margin-top: 4px; }
        .note { font-size: 0.7rem; color: #666; margin-top: 2px; }

        /* FOOTER INFO */
        .info-bar {
            margin-top: 20px; padding: 10px; width: 100%; text-align: center;
            border-top: 1px solid var(--dim); color: #666; font-size: 0.8rem;
        }

    </style>
</head>
<body>

<h1>Geometric Pulse Engine</h1>

<div class="controls">
    <input type="number" id="inpNum" value="21" placeholder="Target N">
    <button onclick="loadEngine()">LOAD TARGET</button>
</div>

<div id="vis-container">
    <canvas id="canvas"></canvas>
    <div class="overlay-tag">GNOMON SCOPE</div>
</div>

<div class="slider-box">
    <div class="frame-info">
        <span>TIMELINE SCRUBBER</span>
        <span id="pulseLabel" style="color:var(--main)">--</span>
    </div>
    <input type="range" id="timeSlider" min="1" max="1" value="1" oninput="updateState()">
    <div class="frame-info">
        <span>FRAME <span id="frameVal" style="color:#fff; font-weight:bold;">1</span></span>
        <span>INDEX <span id="idxVal" style="color:#fff;">--</span></span>
    </div>
</div>

<div class="math-box active">
    <div class="lbl" style="color:var(--sub); margin-bottom:10px;">THE PULSE CHAIN (Symmetry)</div>
    <div class="chain-row">
        <span class="chain-eq" id="chain-pulse">--</span>
        <span class="chain-note">PULSE</span>
    </div>
    <div class="chain-row" style="border:none;">
        <span class="chain-eq" id="chain-split" style="font-size:1.1rem; color:var(--sub);">--</span>
        <span class="chain-note">SQUARE</span>
    </div>
</div>

<div class="lbl" style="width:100%; text-align:left; color:#888;">THE DNA SEQUENCE</div>
<div class="dna-container" id="dnaList">
    </div>

<div class="math-box">
    <div class="lbl">SHELL SUMMATION</div>
    <div id="mathStream" style="line-height:1.4; word-wrap:break-word;">--</div>
</div>

<div class="dash-grid">
    <div class="card">
        <div class="lbl">Total Square</div>
        <div class="val" id="sqVal">--</div>
        <div class="sub">√<span id="rootVal">--</span></div>
    </div>
    <div class="card highlight">
        <div class="lbl">Active Shell</div>
        <div class="val" id="shellVal" style="color:var(--sub)">--</div>
        <div class="sub"><span id="shellMult">--</span> × 8</div>
        <div class="note">This is the Gnomon</div>
    </div>
    <div class="card">
        <div class="lbl">Triangle Base</div>
        <div class="val" id="triBase">--</div>
        <div class="note">Count of Shells</div>
    </div>
    <div class="card">
        <div class="lbl">Triangle Sum</div>
        <div class="val" id="triSum" style="color:var(--main)">--</div>
        <div class="note">Total 8s Used</div>
    </div>
</div>

<div class="info-bar">
    LOGIC: Square = (8 × Triangle) + 1
</div>

<script>
    let canvas, ctx;
    let maxIndex = 1;
    let targetN = 21;

    function init() {
        canvas = document.getElementById('canvas');
        ctx = canvas.getContext('2d');
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        loadEngine();
    }

    function resizeCanvas() {
        const rect = document.getElementById('vis-container').getBoundingClientRect();
        canvas.width = rect.width;
        canvas.height = rect.height;
        updateState();
    }

    function loadEngine() {
        const val = parseInt(document.getElementById('inpNum').value);
        if(val && val % 2 !== 0) {
            targetN = val;
            maxIndex = Math.max(25, (targetN + 1)/2 + 5); 
            const slider = document.getElementById('timeSlider');
            slider.max = maxIndex;
            slider.value = Math.min((targetN + 1) / 2, maxIndex);
            updateState();
        } else {
            alert("Please enter an odd number.");
        }
    }

    function updateState() {
        const frame = parseInt(document.getElementById('timeSlider').value);
        
        // Math
        const root = (2 * frame) - 1;
        const square = root * root;
        const prevRoot = Math.max(1, root - 2);
        
        const prevSquare = (frame === 1) ? 0 : prevRoot * prevRoot;
        const shellVol = square - prevSquare;
        
        const triBase = frame - 1;
        const triSum = (triBase * (triBase + 1)) / 2;

        // UI Updates
        document.getElementById('frameVal').innerText = frame;
        document.getElementById('idxVal').innerText = frame; 
        document.getElementById('pulseLabel').innerText = (frame === 1) ? "SEED" : "EXPAND (+2)";
        document.getElementById('sqVal').innerText = square;
        document.getElementById('rootVal').innerText = root;
        document.getElementById('shellVal').innerText = (frame === 1) ? "1" : shellVol;
        document.getElementById('shellMult').innerText = triBase; 
        document.getElementById('triBase').innerText = triBase;
        document.getElementById('triSum').innerText = triSum;

        drawVisualizer(frame, root);
        updateCalculations(frame, root, square, prevRoot);
    }

    function updateCalculations(frame, root, square, prevRoot) {
        // 1. PULSE CHAIN
        // Logic: Prev + 2 = Curr
        // Logic: Wing + Spine + Wing = Square
        
        const wing = (root * (root - 1)) / 2;
        // Or using our symmetric split for odd numbers:
        // n * (n-1)/2 is actually... let's check. 
        // 5 -> 5 * 2 = 10. 10 + 5 + 10 = 25. Correct.
        // 3 -> 3 * 1 = 3. 3 + 3 + 3 = 9. Correct.
        // 1 -> 1 * 0 = 0. 0 + 1 + 0 = 1. Correct.
        const wingVal = (frame === 1) ? 0 : (root * ((root - 1) / 2));
        
        let pulseStr = (frame === 1) ? "1 = 1 (Seed)" : `${prevRoot} + 2 = ${root}`;
        document.getElementById('chain-pulse').innerText = pulseStr;
        
        let splitStr = `${wingVal} + ${root} + ${wingVal} = ${square}`;
        document.getElementById('chain-split').innerText = splitStr;

        // 2. DNA LADDER
        const dnaList = document.getElementById('dnaList');
        dnaList.innerHTML = "";
        
        // Build history up to current frame
        for (let i = 1; i <= frame; i++) {
            let r = (2 * i) - 1;
            let pr = Math.max(1, r - 2);
            
            let rowDiv = document.createElement('div');
            rowDiv.className = "dna-row";
            if (i === frame) rowDiv.classList.add('highlight');
            
            if (i === 1) {
                rowDiv.innerHTML = `<span>1x1</span> <span>= 1x1</span>`;
            } else {
                // "3x1 + 2x1 = 5x1" format
                rowDiv.innerHTML = `<span>${pr}x1 + 2x1</span> <span>= ${r}x1</span>`;
            }
            dnaList.prepend(rowDiv); // Newest on top
        }

        // 3. SHELL SUMMATION
        const mathBox = document.getElementById('mathStream');
        let html = "<span style='color:#fff'>1</span>";
        if (frame > 1) {
            for (let i = 1; i < frame; i++) {
                let term = i * 8;
                let style = (i === frame - 1) ? "color:var(--sub); font-weight:bold;" : "";
                html += ` + <span style='${style}'>${term}</span>`;
            }
        }
        html += ` = <span style='color:#fff; font-weight:bold;'>${square}</span>`;
        mathBox.innerHTML = html;
    }

    function drawVisualizer(k, root) {
        ctx.fillStyle = "#000";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        const cx = canvas.width / 2;
        const cy = canvas.height / 2;
        const padding = 20;
        const availableSize = Math.min(canvas.width, canvas.height) - padding;
        const cellSize = availableSize / root;

        for(let i = 1; i <= k; i++) {
            let loopRoot = (2 * i) - 1;
            let loopSize = loopRoot * cellSize;
            let isCurrent = (i === k);
            
            if (i === 1) {
                ctx.fillStyle = "#ffcc00"; 
                ctx.fillRect(cx - cellSize/2, cy - cellSize/2, cellSize-1, cellSize-1);
            } else {
                ctx.strokeStyle = isCurrent ? "#00ffff" : "#333"; 
                ctx.lineWidth = isCurrent ? cellSize : (cellSize - 1); 
                
                let strokeSize = loopSize - cellSize; 
                ctx.strokeRect(cx - strokeSize/2, cy - strokeSize/2, strokeSize, strokeSize);
            }
        }
    }

    setTimeout(init, 100);

</script>
</body>
</html>
