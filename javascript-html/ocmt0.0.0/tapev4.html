<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGS Multiplier Tape (Times-N Strategy)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #020617; color: #e2e8f0; font-family: 'Courier New', monospace; }
        .panel { background: #0f172a; border: 1px solid #1e293b; border-radius: 8px; padding: 1.5rem; }
        .input-glow { border: 1px solid #334155; background: #1e293b; color: #6ee7b7; text-align: center; }
        .input-glow:focus { border-color: #10b981; outline: none; box-shadow: 0 0 10px #059669; }
        .log-entry { margin-bottom: 4px; border-bottom: 1px solid #1e293b; padding-bottom: 2px; }
    </style>
</head>
<body class="p-4">
    <div class="max-w-3xl mx-auto panel">
        <h1 class="text-2xl font-bold text-emerald-500 text-center mb-4">SGS MULTIPLIER TAPE</h1>
        
        <div class="mb-6">
            <label class="text-xs text-slate-500 uppercase font-bold">Target RSA Number (N)</label>
            <input id="targetN" type="text" class="w-full p-3 rounded input-glow text-lg" placeholder="Enter 60-digit number">
        </div>

        <div class="grid grid-cols-2 gap-4 mb-6">
            <div>
                <label class="text-xs text-slate-500 uppercase font-bold">Max Multiplier (k)</label>
                <input id="maxK" type="number" class="w-full p-3 rounded input-glow" value="100">
            </div>
            <div>
                <label class="text-xs text-slate-500 uppercase font-bold">Search Depth (Rows per k)</label>
                <input id="depth" type="number" class="w-full p-3 rounded input-glow" value="50000">
            </div>
        </div>

        <button onclick="startMultiplierRun()" id="runBtn" class="w-full bg-emerald-600 hover:bg-emerald-500 p-4 rounded font-black tracking-widest uppercase mb-4">Run "Next Square" Check</button>
        
        <div id="logBox" class="bg-black p-4 rounded h-64 overflow-y-auto text-xs text-emerald-300 font-mono border border-slate-800">
            System Ready. Enter N to check multipliers.
        </div>
    </div>

<script>
const logBox = document.getElementById('logBox');

function log(msg, type = 'info') {
    const div = document.createElement('div');
    div.className = 'log-entry';
    if(type === 'success') div.style.color = '#4ade80'; 
    if(type === 'warn') div.style.color = '#facc15';
    div.innerText = `> ${msg}`;
    logBox.prepend(div);
}

function startMultiplierRun() {
    const nStr = document.getElementById('targetN').value;
    const maxK = parseInt(document.getElementById('maxK').value);
    const depth = parseInt(document.getElementById('depth').value);

    if (!nStr) return alert("Please enter N");

    log(`Starting Multiplier Scan on N...`);
    
    // We run this in a loop with small timeouts to keep UI responsive
    let N = BigInt(nStr);
    let k = 1;

    function runBatch() {
        if (k > maxK) {
            log("Scan Complete. No lock found in this range.", 'warn');
            return;
        }

        // --- THE STRATEGY: 5N, 3N, etc ---
        let target = N * BigInt(k);
        let root = sqrtBigInt(target);
        if (root * root < target) root++; // Start at ceil(sqrt(kN))

        // Check the "Next Squares"
        for (let i = 0n; i < BigInt(depth); i++) {
            let a = root + i;
            let diff = (a * a) - target; // a^2 - kN

            if (isSquare(diff)) {
                let b = sqrtBigInt(diff);
                let valA = a - b;
                let valB = a + b;
                
                // Found factors of kN. Extract factor of N.
                let p = gcd(valA, N);
                if (p > 1n && p < N) {
                    let q = N / p;
                    log(`!!! HIT FOUND at Multiplier x${k} !!!`, 'success');
                    log(`Row Offset: ${i}`, 'success');
                    log(`Factor P: ${p}`, 'success');
                    log(`Factor Q: ${q}`, 'success');
                    return; // Stop!
                }
            }
        }
        
        // Log progress every few multipliers so we know it's working
        if (k % 5 === 0) log(`Checked x${k} (Depth: ${depth} rows)...`);
        
        k++;
        setTimeout(runBatch, 5); // Yield to UI
    }

    runBatch();
}

// --- Math Helpers ---
function sqrtBigInt(n) {
    if (n < 0n) throw "Negative";
    if (n < 2n) return n;
    let x = n, y = (x + n / x) / 2n;
    while (y < x) { x = y; y = (x + n / x) / 2n; }
    return x;
}

function isSquare(n) {
    if (n < 0n) return false;
    let s = sqrtBigInt(n);
    return s * s === n;
}

function gcd(a, b) {
    while (b > 0n) {
        let temp = b;
        b = a % b;
        a = temp;
    }
    return a;
}
</script>
</body>
</html>
