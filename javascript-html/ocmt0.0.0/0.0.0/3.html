<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ANDY'S TAPE: CRUISE CONTROL</title>
<style>
    :root {
        --bg: #020617; 
        --panel: #0f172a; 
        --border: #1e293b;
        --cyan: #22d3ee; 
        --pink: #f472b6;
        --green: #34d399;
        --text: #e2e8f0; 
    }
    body {
        background-color: var(--bg);
        color: var(--text);
        font-family: 'Courier New', Courier, monospace;
        margin: 0;
        display: flex;
        flex-direction: column;
        height: 100vh;
        overflow: hidden;
    }

    /* --- HUD / CONTROLS --- */
    .controls {
        background: var(--panel);
        border-bottom: 2px solid var(--cyan);
        padding: 15px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        z-index: 100;
    }
    .status-bar {
        font-size: 12px;
        color: var(--cyan);
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 5px;
        display: flex;
        justify-content: space-between;
    }
    .input-group {
        display: flex;
        gap: 10px;
    }
    input {
        background: rgba(0,0,0,0.3);
        border: 1px solid var(--border);
        color: #fff;
        padding: 10px;
        font-family: inherit;
        font-size: 16px;
        flex: 1;
        outline: none;
    }
    input:focus { border-color: var(--cyan); }
    
    button {
        background: var(--cyan);
        color: #000;
        border: none;
        padding: 10px 20px;
        font-weight: bold;
        cursor: pointer;
        text-transform: uppercase;
        font-family: inherit;
    }
    button:hover { background: #fff; }
    button.secondary {
        background: transparent;
        border: 1px solid var(--pink);
        color: var(--pink);
    }
    button.secondary:hover { background: var(--pink); color: #000; }

    /* --- THE TAPE (LOGBOOK) --- */
    .tape-container {
        flex: 1;
        overflow-y: auto;
        padding: 0;
        position: relative;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
    }
    thead {
        position: sticky;
        top: 0;
        background: var(--bg);
        z-index: 10;
        box-shadow: 0 2px 10px rgba(0,0,0,0.5);
    }
    th {
        text-align: left;
        padding: 12px 15px;
        color: #64748b;
        font-size: 10px;
        letter-spacing: 1px;
        text-transform: uppercase;
        border-bottom: 1px solid var(--border);
    }
    td {
        padding: 8px 15px;
        border-bottom: 1px solid #1e293b;
        font-variant-numeric: tabular-nums;
    }
    tr:hover { background: rgba(34, 211, 238, 0.05); }

    /* Column Styling */
    .col-id { color: #64748b; width: 80px; }
    .col-smart { color: var(--cyan); font-weight: bold; width: 120px; }
    .col-val { color: #fff; font-weight: bold; }
    .col-factors { color: var(--pink); text-align: right; }

    /* Special Rows */
    .highlight { background: rgba(34, 211, 238, 0.15) !important; }
    .prime-row { background: rgba(244, 114, 182, 0.1) !important; color: var(--pink); }

    /* Loading / Messages */
    .msg-box { padding: 20px; text-align: center; color: #64748b; font-style: italic; }

</style>
</head>
<body>

    <div class="controls">
        <div class="status-bar">
            <span>System: Method of Differences</span>
            <span id="sysStatus">IDLE</span>
        </div>
        <div class="input-group">
            <input type="text" id="numInput" placeholder="Enter Number (e.g. 1007 or 23)">
            <button onclick="findNumber()">SCAN</button>
        </div>
        <div class="input-group">
            <button class="secondary" onclick="loadTape(26)">Load Highway 53</button>
            <button class="secondary" onclick="loadTape(1)">Load Highway 3</button>
        </div>
    </div>

    <div class="tape-container">
        <table id="tapeTable">
            <thead>
                <tr>
                    <th>Tape ID</th>
                    <th>Smart ID (a.b)</th>
                    <th>Value (Cargo)</th>
                    <th style="text-align:right">Factors</th>
                </tr>
            </thead>
            <tbody id="tapeBody">
                </tbody>
        </table>
    </div>

<script>
    // --- ENGINE CORE (BigInt Math) ---

    // 1. Calculate Linear Tape ID
    // Formula: Triangle(Row) + Gap
    function getTapeID(row, gap) {
        // (Row * (Row + 1)) / 2 + Gap
        const base = (row * (row + 1n)) / 2n; 
        return base + gap;
    }

    // 2. The "Cruise Control" Generator
    // Generates a list by ADDING, not calculating roots.
    function loadTape(rowNum) {
        const tableBody = document.getElementById('tapeBody');
        tableBody.innerHTML = "";
        document.getElementById('sysStatus').innerText = `GENERATING ROW ${rowNum}...`;

        let row = BigInt(rowNum);
        
        // Setup the Highway (Factor = 2*Row + 1)
        let bigFactor = (row * 2n) + 1n; 
        
        // The Step Size (Method of Differences)
        // Every step on this row adds (2 * BigFactor)
        let stepSize = bigFactor * 2n; 
        
        // Start Point: Gap 0 (Perfect Square)
        let currentValue = bigFactor * bigFactor; 
        
        // Generate 100 entries instantly
        let html = "";
        for (let i = 0; i < 100; i++) {
            
            // Derive Smart ID Geometry from current values
            // We know BigFactor is constant.
            // SmallFactor increases by 2 every step.
            let smallFactor = currentValue / bigFactor;
            
            // Calculate a (Anchor) and b (Gap)
            let anchor = (bigFactor + smallFactor) / 2n;
            let gap = (bigFactor - smallFactor) / 2n;

            let tapeID = getTapeID(row, gap);
            let smartID = `${anchor}.${gap}`;

            html += `
                <tr>
                    <td class="col-id">${tapeID}</td>
                    <td class="col-smart">${smartID}</td>
                    <td class="col-val">${currentValue}</td>
                    <td class="col-factors">${bigFactor} × ${smallFactor}</td>
                </tr>
            `;

            // THE ENGINE: Just Add. No roots.
            currentValue += stepSize;
        }
        
        tableBody.innerHTML = html;
        document.getElementById('sysStatus').innerText = `HIGHWAY ${bigFactor} LOADED`;
    }

    // 3. The Smart Scanner (Find Number)
    // Uses the "Increment Method" to scan for the address.
    function findNumber() {
        const input = document.getElementById('numInput').value.trim();
        if (!input) return;
        
        const N = BigInt(input);
        const tableBody = document.getElementById('tapeBody');
        document.getElementById('sysStatus').innerText = `SCANNING FOR ${N}...`;
        tableBody.innerHTML = `<tr><td colspan="4" class="msg-box">Scanning Geometry...</td></tr>`;

        // Allow UI to update before freezing
        setTimeout(() => {
            
            // Step A: Calculate Entrance Ramp (One Root)
            let anchor = sqrtBigInt(N);
            if (anchor * anchor < N) anchor++; // Ceiling

            // Optimization: Limit search depth for demo
            let maxIterations = 200000; 
            let found = false;

            // Current Residue (Anchor^2 - N)
            let residue = (anchor * anchor) - N;

            for (let i = 0; i < maxIterations; i++) {
                
                // Is Residue a Square? (Gap^2)
                let gap = sqrtBigInt(residue);
                
                if (gap * gap === residue) {
                    // Match Found!
                    
                    // Check Trivial (Small Factor = 1)
                    let smallFactor = anchor - gap;
                    
                    if (smallFactor === 1n) {
                        // If we hit the Trivial Factor (1 x N) and haven't found anything else...
                        // It is PRIME.
                        tableBody.innerHTML = `
                            <tr class="prime-row highlight">
                                <td class="col-id">--</td>
                                <td class="col-smart">${anchor}.${gap}</td>
                                <td class="col-val">${N}</td>
                                <td class="col-factors">PRIME (1 × ${N})</td>
                            </tr>
                        `;
                        document.getElementById('sysStatus').innerText = `PRIME DETECTED`;
                        found = true;
                        break; 
                    } else {
                        // COMPOSITE FOUND (The Good Stuff)
                        let bigFactor = anchor + gap;
                        let row = (bigFactor - 1n) / 2n;
                        let tapeID = getTapeID(row, gap);

                        tableBody.innerHTML = `
                            <tr class="highlight">
                                <td class="col-id">${tapeID}</td>
                                <td class="col-smart">${anchor}.${gap}</td>
                                <td class="col-val">${N}</td>
                                <td class="col-factors">${bigFactor} × ${smallFactor}</td>
                            </tr>
                        `;
                        document.getElementById('sysStatus').innerText = `TARGET ACQUIRED`;
                        found = true;
                        break;
                    }
                }

                // CRUISE CONTROL: Next Anchor
                // Add (2 * Anchor) + 1 to residue
                residue += (anchor * 2n) + 1n;
                anchor++;
            }

            if (!found) {
                tableBody.innerHTML = `<tr><td colspan="4" class="msg-box">Search Limit Reached (Try smaller number or optimize loop)</td></tr>`;
            }

        }, 10);
    }

    // Helper: BigInt Square Root
    function sqrtBigInt(n) {
        if (n < 0n) throw 'Negative';
        if (n < 2n) return n;
        let x = n;
        let y = (x + 1n) / 2n;
        while (y < x) {
            x = y;
            y = (x + n / x) / 2n;
        }
        return x;
    }

    // Auto-load a demo row
    loadTape(26);

</script>

</body>
</html>
