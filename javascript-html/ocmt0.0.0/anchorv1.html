<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANCHOR RESOLVER v2</title>
    <style>
        :root { --a: #facc15; --n: #22d3ee; --b: #f472b6; --bg: #020617; }
        body { background: var(--bg); color: #e2e8f0; font-family: 'Courier New', monospace; margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        .top { background: #0f172a; padding: 10px; border-bottom: 2px solid var(--a); display: flex; gap: 10px; align-items: center; }
        input { background: #000; border: 1px solid var(--a); color: #fff; padding: 8px; flex: 1; font-weight: bold; outline: none; }
        button { background: var(--a); border: none; padding: 8px 15px; font-weight: 900; cursor: pointer; }
        .stats { display: grid; grid-template-columns: repeat(3, 1fr); background: #1e293b; font-size: 0.75rem; text-align: center; }
        .stats div { padding: 4px; border: 1px solid #0f172a; }
        #out { flex: 1; overflow-y: auto; padding: 10px; white-space: pre; font-size: 0.85rem; line-height: 1.2; background: #000; }
        .row { display: flex; border-bottom: 1px solid #111; }
        .c1 { color: var(--b); width: 80px; }
        .c2 { color: var(--n); width: 150px; font-weight: bold; }
        .c3 { color: #64748b; }
    </style>
</head>
<body>

<div class="top">
    <input type="text" id="inpA" placeholder="Enter Anchor (a)..." value="100">
    <button onclick="run()">RESOLVE</button>
</div>

<div class="stats">
    <div>ANCHOR: <span id="statA" style="color:var(--a)">-</span></div>
    <div>SPINE (aÂ²): <span id="statSq" style="color:#fff">-</span></div>
    <div>GNOMON (2a-1): <span id="statG" style="color:var(--n)">-</span></div>
</div>

<div id="out">Enter Anchor to stream the b-offset ladder...</div>

<script id="worker" type="text/javascript">
    self.onmessage = function(e) {
        const a = BigInt(e.data.a);
        const aSq = a * a;
        
        for (let b = 0n; b < a; b++) {
            let N = aSq - (b * b);
            if (N > 0n && N % 2n !== 0n) {
                // Formatting for the terminal-style output
                let line = `${b.toString().padEnd(8)} | ${N.toString().padEnd(15)} | (${a-b})*(${a+b})`;
                self.postMessage({ type: 'row', data: line });
            }
            if (b > 0n && b % 1000n === 0n) self.postMessage({ type: 'tick' });
        }
    };
</script>

<script>
    let worker;
    const blob = new Blob([document.getElementById('worker').textContent], { type: 'text/javascript' });

    function run() {
        const aVal = document.getElementById('inpA').value;
        const a = BigInt(aVal);
        
        // Metadata Updates
        document.getElementById('statA').innerText = a;
        document.getElementById('statSq').innerText = a * a;
        document.getElementById('statG').innerText = (2n * a) - 1n;
        
        const out = document.getElementById('out');
        out.innerHTML = `B-OFFSET | CARGO (N)      | FACTOR PAIRS\n${'-'.repeat(45)}\n`;

        if (worker) worker.terminate();
        worker = new Worker(window.URL.createObjectURL(blob));
        
        worker.onmessage = function(e) {
            if (e.data.type === 'row') {
                const div = document.createElement('div');
                div.textContent = e.data.data;
                out.appendChild(div);
                if (out.childNodes.length < 100) out.scrollTop = out.scrollHeight;
            }
        };
        worker.postMessage({ a: aVal });
    }
</script>

</body>
</html>
