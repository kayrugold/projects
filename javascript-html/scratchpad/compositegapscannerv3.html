<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Composite Gap Scanner v2.2</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
    body { background-color: #0f172a; color: #e2e8f0; font-family: monospace; padding: 20px; }
    
    .scanner-box { 
        background: #1e293b; border: 1px solid #334155; border-radius: 12px; 
        padding: 20px; display: flex; flex-direction: column; gap: 20px;
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.5);
        max-width: 600px; margin: 0 auto; position: relative;
    }

    .input-group { display: flex; gap: 10px; }
    
    input { 
        background: #020617; border: 1px solid #475569; color: white; 
        padding: 12px 16px; border-radius: 6px; font-size: 1.2rem; width: 100%; 
        font-family: monospace; font-weight: bold;
    }
    
    button { 
        background: #3b82f6; color: white; border: none; padding: 0 20px; 
        border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 1rem;
        transition: background 0.2s; white-space: nowrap;
    }
    button:hover { background: #2563eb; }

    /* SCROLL CONTAINER */
    .gap-strip-container {
        width: 100%; overflow-x: auto; padding: 20px 0; -webkit-overflow-scrolling: touch; 
    }

    .gap-strip {
        display: flex; gap: 12px; justify-content: flex-start; 
        min-width: min-content; margin: 0 auto; padding: 0 20px;
    }

    .num-block {
        flex-shrink: 0; padding: 16px; border-radius: 8px; font-weight: bold; 
        border: 1px solid transparent; min-width: 90px; text-align: center;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        transition: transform 0.2s, box-shadow 0.2s; position: relative;
        cursor: pointer;
    }
    .num-block:active { transform: scale(0.95); }

    /* COLORS */
    .type-comp { 
        background: #450a0a; color: #fca5a5; border-color: #7f1d1d; 
        box-shadow: 0 4px 0 #7f1d1d;
    }
    .type-comp:hover { border-color: #ef4444; background: #551111; }
    
    .type-prime { 
        background: #064e3b; color: #34d399; border-color: #059669; 
        box-shadow: 0 4px 0 #059669;
    } 
    .type-target { 
        border: 2px solid #fbbf24; z-index: 20; 
        box-shadow: 0 0 25px rgba(251, 191, 36, 0.25), 0 4px 0 #b45309; 
        transform: scale(1.05);
    }

    .main-num { font-size: 1.6rem; line-height: 1; margin-bottom: 4px; }
    .sub-label { font-size: 0.7rem; opacity: 0.8; letter-spacing: 1px; text-transform: uppercase; }
    
    .pickup-eq {
        background: rgba(0,0,0,0.4); padding: 4px 8px; border-radius: 4px;
        margin-top: 8px; font-size: 0.8rem; color: #fff;
        font-family: 'Courier New', monospace; white-space: nowrap;
        border: 1px solid rgba(255,255,255,0.1);
    }
    .engine-id { color: #fbbf24; font-weight: bold; }

    /* MODAL (THE INSPECTOR) */
    .inspector-modal {
        position: fixed; top: 0; left: 0; w-full; h-full; width: 100vw; height: 100vh;
        background: rgba(0,0,0,0.85); backdrop-filter: blur(5px);
        display: none; justify-content: center; align-items: center; z-index: 100;
        opacity: 0; transition: opacity 0.2s;
    }
    .inspector-modal.open { display: flex; opacity: 1; }
    
    .modal-content {
        background: #1e293b; border: 1px solid #475569; padding: 24px;
        border-radius: 12px; width: 90%; max-width: 400px;
        box-shadow: 0 20px 50px rgba(0,0,0,0.8);
        transform: translateY(20px); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .inspector-modal.open .modal-content { transform: translateY(0); }

    .step-row { display: flex; align-items: center; justify-content: space-between; padding: 8px 0; border-bottom: 1px dashed #334155; }
    .step-label { font-size: 0.75rem; color: #94a3b8; text-transform: uppercase; }
    .step-math { font-size: 1rem; color: #e2e8f0; font-weight: bold; }
    
    .step-jump { text-align: center; color: #fbbf24; font-size: 0.8rem; padding: 4px 0; font-weight: bold; }

    .highlight-current { background: rgba(59, 130, 246, 0.1); border-radius: 4px; border: 1px solid rgba(59, 130, 246, 0.3); padding: 8px; margin: 4px 0; border-bottom: none; }

</style>
</head>
<body>

<div class="scanner-box">
    <div>
        <label class="text-xs text-blue-400 font-bold uppercase tracking-wider mb-2 block">Center Odd Number</label>
        <div class="input-group">
            <input type="number" id="inpNum" value="101" step="2">
            <button onclick="scanGap()">SCAN GAP</button>
        </div>
    </div>

    <div>
        <div class="gap-strip-container" id="scrollWrapper">
            <div id="gapContainer" class="gap-strip">
                <span class="text-slate-500 italic self-center">Ready to scan...</span>
            </div>
        </div>
        <div class="text-center text-xs text-slate-500 mt-2">Click any tile to see the work</div>
    </div>
</div>

<div id="workModal" class="inspector-modal" onclick="closeModal(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="flex justify-between items-start mb-4 border-b border-slate-700 pb-2">
            <div>
                <div class="text-xs text-slate-400 uppercase tracking-widest">Inspection</div>
                <div id="modalTitle" class="text-3xl font-bold text-white">--</div>
            </div>
            <button onclick="closeModal()" class="text-slate-500 hover:text-white bg-transparent p-0 text-2xl">&times;</button>
        </div>

        <div id="modalBody">
            </div>
        
        <div class="mt-6 text-center">
            <button onclick="closeModal()" class="w-full bg-slate-700 hover:bg-slate-600 py-2">Close</button>
        </div>
    </div>
</div>

<script>
// --- LOGIC ---

function identifySource(n) {
    // Priority: 3, 5, then brute force
    if (n % 3n === 0n) return { engine: 3n, factor: n/3n };
    if (n % 5n === 0n) return { engine: 5n, factor: n/5n };
    
    let limit = n; 
    for (let i = 7n; i * i <= n; i += 2n) {
        if (n % i === 0n) return { engine: i, factor: n/i };
        if (i > 1000n) break;
    }
    return null;
}

function isComposite(n) {
    if (n <= 3n) return false;
    if (n % 2n === 0n) return true;
    return identifySource(n) !== null;
}

// --- UI LOGIC ---

function inspectNumber(nStr, type) {
    const n = BigInt(nStr);
    const modal = document.getElementById('workModal');
    const title = document.getElementById('modalTitle');
    const body = document.getElementById('modalBody');
    
    title.innerText = n.toString();
    title.className = type === 'comp' ? "text-3xl font-bold text-red-400" : "text-3xl font-bold text-green-400";
    
    if (type === 'prime') {
        body.innerHTML = `
            <div class="text-center py-8">
                <div class="text-green-400 text-lg font-bold mb-2">PRIME GAP</div>
                <div class="text-slate-400 text-sm">No arithmetic engine lands here.</div>
                <div class="text-slate-500 text-xs mt-4">It survived the sieve.</div>
            </div>
        `;
    } else {
        // It's composite, show the work
        const src = identifySource(n);
        if (!src) {
             body.innerHTML = `<div class="text-center text-slate-400">Large factor composite. Source unclear.</div>`;
        } else {
            const E = src.engine;
            const F = src.factor;
            const prevF = F - 2n;
            const nextF = F + 2n;
            const prevVal = E * prevF;
            const nextVal = E * nextF;
            const jump = E * 2n;

            body.innerHTML = `
                <div class="mb-4 text-xs text-yellow-500 uppercase tracking-widest text-center">
                    Generating Engine: ${E}
                </div>
                
                <div class="bg-slate-900 rounded p-4 border border-slate-700">
                    <div class="step-row opacity-50">
                        <span class="step-label">Prev Odd Step</span>
                        <span class="step-math">${E} × ${prevF} = ${prevVal}</span>
                    </div>
                    
                    <div class="step-jump">
                        ↓ (+${jump})
                    </div>
                    
                    <div class="step-row highlight-current">
                        <span class="step-label text-white">Target Hit</span>
                        <span class="step-math text-white">${E} × ${F} = ${n}</span>
                    </div>

                    <div class="step-jump">
                        ↓ (+${jump})
                    </div>

                    <div class="step-row opacity-50">
                        <span class="step-label">Next Odd Step</span>
                        <span class="step-math">${E} × ${nextF} = ${nextVal}</span>
                    </div>
                </div>
                
                <div class="mt-4 text-xs text-slate-500 text-center italic">
                    The ${E}-Engine hits every ${jump} numbers (skipping evens).
                </div>
            `;
        }
    }
    
    modal.classList.add('open');
}

function closeModal(e) {
    if (e && e.target !== document.getElementById('workModal')) return; // Allow clicking content
    document.getElementById('workModal').classList.remove('open');
}


function scanGap() {
    const raw = document.getElementById('inpNum').value;
    let center;
    try { center = BigInt(raw); } catch(e) { return; }
    if (center % 2n === 0n) center += 1n; 
    document.getElementById('inpNum').value = center.toString();
    
    let low = center - 2n;
    while (!isComposite(low) && low > 1n) low -= 2n;
    if (low < 1n) low = 1n; 

    let high = center + 2n;
    while (!isComposite(high)) high += 2n;

    renderStrip(low, high, center);
}

function renderStrip(low, high, target) {
    const container = document.getElementById('gapContainer');
    container.innerHTML = '';
    
    let current = low;
    let count = 0;
    
    while (current <= high) {
        const div = document.createElement('div');
        const isComp = (current === low || current === high);
        const isTgt = (current === target);
        const valStr = current.toString(); // capture for closure
        const typeStr = isComp ? 'comp' : 'prime';
        
        div.className = `num-block ${isComp ? 'type-comp' : 'type-prime'} ${isTgt ? 'type-target' : ''}`;
        div.onclick = () => inspectNumber(valStr, typeStr);
        
        const numSpan = document.createElement('div');
        numSpan.className = 'main-num';
        numSpan.innerText = valStr;
        div.appendChild(numSpan);
        
        const label = document.createElement('div');
        label.className = "sub-label";
        
        if (isComp) {
            label.innerText = "WALL";
            div.appendChild(label);
            const src = identifySource(current);
            if (src) {
                const eqDiv = document.createElement('div');
                eqDiv.className = 'pickup-eq';
                eqDiv.innerHTML = `<span class="engine-id">${src.engine}</span> × ${src.factor}`;
                div.appendChild(eqDiv);
            }
        } else {
            label.innerText = "GAP";
            div.appendChild(label);
        }
        
        container.appendChild(div);
        
        if (isTgt) {
            setTimeout(() => {
                div.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
            }, 100);
        }

        current += 2n;
        count++;
        if (count > 100) {
            const span = document.createElement('div');
            span.innerText = "...";
            span.style.color = "#64748b";
            span.style.alignSelf = "center";
            container.appendChild(span);
            break;
        }
    }
}

scanGap();
</script>
</body>
</html>
