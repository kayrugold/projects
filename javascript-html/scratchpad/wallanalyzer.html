<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Gnomon Analyzer</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
    body { background-color: #0f172a; color: #e2e8f0; font-family: 'Courier New', monospace; padding: 20px; }
    .card { background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5); }
    .highlight { color: #fbbf24; font-weight: bold; }
    .prime-text { color: #4ade80; font-weight: bold; }
    .comp-text { color: #ef4444; font-weight: bold; }
    .wall-val { font-size: 1.2rem; font-weight: bold; }
    
    /* GNOMON GRID */
    .gnomon-container { 
        display: flex; justify-content: center; align-items: center; 
        padding: 20px; background: #020617; border-radius: 8px; border: 1px dashed #475569;
        overflow: auto; min-height: 200px;
    }
    .grid-canvas { display: grid; gap: 2px; }
    .dot { width: 12px; height: 12px; background: #334155; border-radius: 2px; }
    .dot.corner { background: #fbbf24; box-shadow: 0 0 10px rgba(251, 191, 36, 0.5); }
    .dot.arm { background: #94a3b8; }
    
    .input-group { display: flex; gap: 10px; margin-bottom: 20px; }
    input { background: #0f172a; border: 1px solid #475569; color: white; padding: 10px; border-radius: 4px; flex-grow: 1; font-family: inherit; font-size: 1.1rem;}
    button { background: #3b82f6; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 1.1rem; }
    button:hover { background: #2563eb; }

    .wall-box { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }
    .wall-arrow { color: #64748b; font-size: 2rem; }
</style>
</head>
<body>

<div class="max-w-3xl mx-auto">
    <h1 class="text-3xl font-bold mb-4 text-blue-400">Gnomon & Wall Analyzer</h1>
    
    <div class="input-group">
        <input type="number" id="inpNumber" placeholder="Enter an Odd Number (e.g., 47, 2003)" value="47">
        <button onclick="analyze()">ANALYZE</button>
    </div>

    <!-- MAIN RESULT -->
    <div class="card" id="resultCard" style="display:none;">
        <div class="text-center mb-4">
            <span class="text-sm text-slate-400 uppercase tracking-widest">Target Analysis</span>
            <div class="text-5xl font-bold mt-2" id="displayNum">--</div>
            <div id="classification" class="text-xl mt-2 tracking-wide">--</div>
        </div>

        <!-- WALL VISUALIZER -->
        <div class="wall-box bg-slate-900 p-4 rounded-lg border border-slate-700">
            <div class="text-center w-1/3">
                <div class="text-xs text-slate-500 mb-1">LOWER WALL</div>
                <div id="lowerWall" class="wall-val text-red-400">--</div>
                <div id="lowerSource" class="text-xs text-slate-600 font-mono mt-1">--</div>
            </div>
            
            <div class="text-center w-1/3 wall-arrow">
                ↔
                <div id="gapSize" class="text-xs text-slate-500 font-mono mt-1">Gap: --</div>
            </div>

            <div class="text-center w-1/3">
                <div class="text-xs text-slate-500 mb-1">UPPER WALL</div>
                <div id="upperWall" class="wall-val text-red-400">--</div>
                <div id="upperSource" class="text-xs text-slate-600 font-mono mt-1">--</div>
            </div>
        </div>
    </div>

    <!-- GNOMON VISUALIZER -->
    <div class="card">
        <h3 class="text-lg font-bold mb-2 text-slate-300">Gnomon Geometry</h3>
        <div class="grid grid-cols-2 gap-4 text-sm mb-4">
            <div>
                <span class="text-slate-500">Structure:</span> 
                <span id="gnomonDesc" class="font-mono text-yellow-200">--</span>
            </div>
            <div>
                <span class="text-slate-500">Category:</span> 
                <span id="mod4Desc" class="font-mono text-blue-200">--</span>
            </div>
             <div>
                <span class="text-slate-500">6k Relation:</span> 
                <span id="mod6Desc" class="font-mono text-purple-200">--</span>
            </div>
             <div>
                <span class="text-slate-500">Square Index (n):</span> 
                <span id="sqIndex" class="font-mono text-slate-200">--</span>
            </div>
        </div>
        
        <div class="gnomon-container">
            <div id="gnomonCanvas" class="grid-canvas">
                <!-- Dots go here -->
                <span class="text-slate-600 italic">Enter a number to see the shape</span>
            </div>
        </div>
    </div>
</div>

<script>
function analyze() {
    const rawVal = document.getElementById('inpNumber').value;
    const N = parseInt(rawVal);
    
    if (!N || N < 1) { alert("Please enter a positive integer."); return; }
    if (N % 2 === 0) { alert("This analyzer focuses on ODD numbers (Gnomons). Please enter an odd number."); return; }
    
    document.getElementById('resultCard').style.display = 'block';
    document.getElementById('displayNum').innerText = N;
    
    // 1. CLASSIFY 4k and 6k
    analyzeStructure(N);
    
    // 2. FIND WALLS (The 3-Engine Logic)
    findWalls(N);
    
    // 3. DRAW GNOMON
    drawGnomon(N);
}

function analyzeStructure(n) {
    // Mod 4
    const m4 = n % 4;
    const m4Text = m4 === 1 ? "4k + 1 (Sum of Squares)" : "4k + 3 (Not Sum of Squares)";
    document.getElementById('mod4Desc').innerText = m4Text;
    
    // Mod 6
    const m6 = n % 6;
    let m6Text = "N/A";
    if (m6 === 1) m6Text = "6k + 1";
    else if (m6 === 5) m6Text = "6k - 1";
    else if (m6 === 3) m6Text = "Multiple of 3";
    document.getElementById('mod6Desc').innerText = m6Text;
    
    // Gnomon Index
    // N = 2n - 1 -> n = (N+1)/2
    const idx = (n + 1) / 2;
    document.getElementById('sqIndex').innerText = `n = ${idx}`;
    document.getElementById('gnomonDesc').innerText = `Wraps ${idx-1}² square`;
}

function findWalls(target) {
    // We scan outward from 'target' to find the nearest composites
    // Logic: A number is composite if generated by the "3-Engine" (odd factors)
    
    let lowerComp = -1;
    let upperComp = -1;
    let lowerSrc = "";
    let upperSrc = "";
    
    // SCAN DOWN
    for (let i = target - 2; i >= 3; i -= 2) {
        let f = getSmallestFactor(i);
        if (f !== i) { // It's composite
            lowerComp = i;
            lowerSrc = `${f} × ${i/f}`;
            break;
        }
    }
    
    // SCAN UP
    for (let i = target + 2; ; i += 2) {
        let f = getSmallestFactor(i);
        if (f !== i) { // It's composite
            upperComp = i;
            upperSrc = `${f} × ${i/f}`;
            break;
        }
        if (i > target + 1000) break; // Safety break
    }
    
    // TARGET STATUS
    let targetFactor = getSmallestFactor(target);
    const isPrime = targetFactor === target;
    
    const classEl = document.getElementById('classification');
    const dispEl = document.getElementById('displayNum');
    
    if (isPrime && target !== 1) {
        classEl.innerText = "VERDICT: PRIME (Gap Found)";
        classEl.className = "text-xl mt-2 tracking-wide prime-text";
        dispEl.className = "text-5xl font-bold mt-2 prime-text";
    } else {
        classEl.innerHTML = `VERDICT: COMPOSITE<br><span class="text-sm text-slate-400">Hit by ${targetFactor} × ${target/targetFactor}</span>`;
        classEl.className = "text-xl mt-2 tracking-wide comp-text";
        dispEl.className = "text-5xl font-bold mt-2 comp-text";
    }
    
    // UPDATE UI
    document.getElementById('lowerWall').innerText = lowerComp > 0 ? lowerComp : "None";
    document.getElementById('lowerSource').innerText = lowerSrc;
    
    document.getElementById('upperWall').innerText = upperComp;
    document.getElementById('upperSource').innerText = upperSrc;
    
    let gap = upperComp - lowerComp;
    document.getElementById('gapSize').innerText = `Gap Size: ${gap}`;
}

// Simple factor check (The equivalent of the Projection Threads)
function getSmallestFactor(n) {
    if (n===1) return 1;
    const limit = Math.sqrt(n);
    for (let i = 3; i <= limit; i += 2) {
        if (n % i === 0) return i;
    }
    return n;
}

function drawGnomon(n) {
    const canvas = document.getElementById('gnomonCanvas');
    canvas.innerHTML = '';
    
    // Safety for rendering
    if (n > 200) {
        canvas.innerHTML = '<div class="text-center p-4">Gnomon too large to verify visually.<br>Trust the math above!</div>';
        return;
    }

    // A Gnomon of value N has side length (N+1)/2
    // Example: N=7 (index 4). Grid is 4x4.
    // We draw the outer shell of the 4x4 grid.
    
    const side = (n + 1) / 2;
    
    // Set grid columns
    canvas.style.gridTemplateColumns = `repeat(${side}, 12px)`;
    
    // We are drawing a square of size 'side', but only filling the "L"
    // The "L" corresponds to row 1 (all columns) and col 1 (all rows)
    // Actually, visually standard is usually Bottom-Left or Top-Left. Let's do Top-Left L.
    
    for (let r = 0; r < side; r++) {
        for (let c = 0; c < side; c++) {
            const dot = document.createElement('div');
            
            // Logic for L-Shape (Top row and Left column)
            // Or Bottom/Right? Let's do Top Row + Right Column to look like standard Gnomon diagrams
            // Actually, let's do the standard: Add to the previous square.
            // If previous square is top-left, Gnomon is Bottom Row + Right Column.
            
            const isBottomRow = (r === side - 1);
            const isRightCol = (c === side - 1);
            
            if (isBottomRow || isRightCol) {
                dot.className = 'dot arm';
                if (isBottomRow && isRightCol) {
                    dot.className = 'dot corner'; // The pivot
                    dot.title = "The Corner (Pivot)";
                }
            } else {
                // Inner square (ghosts)
                dot.style.background = '#1e293b';
                dot.style.opacity = '0.3';
            }
            
            canvas.appendChild(dot);
        }
    }
}
</script>

</body>
</html>

