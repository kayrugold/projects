<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Factor Hunter: Symbolic Algebra</title>
    <style>
        :root {
            --bg: #050a14;
            --panel: #0f172a;
            --accent: #10b981; /* Matrix Green */
            --hit: #f59e0b;    /* Gold */
            --text: #e2e8f0;
            --text-dim: #475569;
            --wall: #1e293b;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            user-select: none;
            touch-action: none;
        }

        /* TOP BAR */
        #controls {
            height: 60px;
            background: var(--panel);
            border-bottom: 2px solid var(--accent);
            display: flex;
            align-items: center;
            padding: 0 10px;
            gap: 10px;
            z-index: 50;
            box-shadow: 0 4px 20px rgba(0,0,0,0.6);
        }

        .input-wrapper {
            flex: 1;
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 4px;
            height: 40px;
            display: flex;
            align-items: center;
            padding: 0 10px;
        }

        input {
            background: transparent;
            border: none;
            color: var(--accent);
            font-family: inherit;
            font-size: 0.9rem;
            width: 100%;
            font-weight: bold;
            outline: none;
        }

        button {
            height: 40px;
            padding: 0 16px;
            border: none;
            border-radius: 4px;
            font-weight: 800;
            cursor: pointer;
            font-size: 0.9rem;
            text-transform: uppercase;
        }
        #btn-go { background: var(--accent); color: #000; }
        #btn-view { background: #334155; color: #fff; border: 1px solid #475569; }

        /* MAIN VIEWPORT */
        #viewport {
            flex-grow: 1;
            position: relative;
            background: var(--bg);
            cursor: crosshair;
        }
        canvas { display: block; width: 100%; height: 100%; }

        /* SIDE PANEL (The Inspector) */
        #inspector {
            position: absolute;
            top: 60px;
            right: -320px; /* Hidden by default */
            width: 300px;
            bottom: 0;
            background: rgba(15, 23, 42, 0.98);
            border-left: 2px solid var(--accent);
            backdrop-filter: blur(10px);
            transition: right 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        #inspector.open { right: 0; }

        .panel-block {
            border-bottom: 1px solid #334155;
            padding-bottom: 15px;
        }
        .panel-label { color: #64748b; font-size: 0.75rem; text-transform: uppercase; margin-bottom: 5px; letter-spacing: 1px; }
        .panel-val { color: #fff; font-size: 1.1rem; word-break: break-all; font-weight: bold; }
        .panel-big { font-size: 0.85rem; color: var(--accent); max-height: 100px; overflow-y: auto; background: #000; padding: 5px; border-radius: 4px; border: 1px solid #334155; }

        /* STATUS BAR */
        #status-bar {
            height: 30px;
            background: #020617;
            border-top: 1px solid #1e293b;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            font-size: 0.75rem;
            color: #64748b;
        }

    </style>
</head>
<body>

<div id="controls">
    <div class="input-wrapper">
        <input type="text" id="inp-target" placeholder="Enter N (e.g. 10^100+19 or raw digits)" value="10^100 + 19">
    </div>
    <button id="btn-view">TEXT</button>
    <button id="btn-go">HUNT</button>
</div>

<div id="viewport">
    <canvas id="gridCanvas"></canvas>
    
    <div id="inspector">
        <div class="panel-block">
            <div class="panel-label">Grid Coordinate</div>
            <div class="panel-val" id="ins-coords">--</div>
        </div>
        
        <div class="panel-block">
            <div class="panel-label">Factor A (Row)</div>
            <div class="panel-big" id="ins-a">--</div>
        </div>

        <div class="panel-block">
            <div class="panel-label">Factor B (Col)</div>
            <div class="panel-big" id="ins-b">--</div>
        </div>

        <div class="panel-block">
            <div class="panel-label">Symbolic Product (A × B)</div>
            <div class="panel-big" id="ins-prod" style="color: #fff">--</div>
        </div>

        <div class="panel-block">
            <div class="panel-label">Mod 30 Analysis</div>
            <div class="panel-val" id="ins-mod" style="color: var(--hit)">--</div>
        </div>
        
        <button id="btn-close-panel" style="width:100%; background:#334155; color:#fff; border:1px solid #475569">CLOSE</button>
    </div>
</div>

<div id="status-bar">
    <div>TARGET GEOMETRY: <span id="val-geo" style="color:var(--accent)">--</span></div>
    <div>ZOOM: <span id="val-zoom">1.0x</span></div>
</div>

<script>
    // --- CONFIG ---
    const COLORS = {
        bg: '#050a14',
        header: '#0f172a',
        text: '#94a3b8',
        wall: '#0f172a',    // Void Cells
        lane: '#1e293b',    // Prime Lane Base
        hit: '#f59e0b',     // Target Match (Gold)
        grid: '#1e293b',
        textDim: '#475569'
    };

    // --- STATE ---
    let state = {
        // Target Info
        targetBig: 0n,
        targetMod30: 0,
        
        // Navigation
        startRow: 3n, 
        startCol: 3n,
        panX: 0,
        panY: 0,
        zoom: 1.0,
        
        // Display
        showText: true, // Toggle for "Boring Voids"
        
        // Constants
        cellSize: 120, // Wider for text
        headerSize: 60
    };

    const canvas = document.getElementById('gridCanvas');
    const ctx = canvas.getContext('2d', { alpha: false });

    // --- BIGINT PARSER ---
    // Handles "10^100 + 19" OR Raw Digits
    function parseInput(str) {
        str = str.replace(/\s/g, ''); // Remove spaces
        try {
            if (str.includes('^')) {
                let parts = str.split('+');
                let baseParts = parts[0].split('^');
                let base = BigInt(baseParts[0]);
                let exp = BigInt(baseParts[1]);
                let off = parts[1] ? BigInt(parts[1]) : 0n;
                return (base ** exp) + off;
            } else {
                return BigInt(str);
            }
        } catch(e) {
            alert("Invalid Format. Use 10^100+19 or raw digits.");
            return 3n;
        }
    }

    // --- MATH HELPERS ---
    function getMod30(n) { return Number(n % 30n); }
    
    // Format BigInt for Grid Cells
    function fmtCell(a, b) {
        // If zoom is high, show full small numbers
        // If numbers are massive, show symbolic "Tail"
        let sa = a.toString();
        let sb = b.toString();
        
        if (sa.length > 6) sa = ".." + sa.slice(-4);
        if (sb.length > 6) sb = ".." + sb.slice(-4);
        
        return `${sa} × ${sb}`;
    }

    // --- RENDERER ---
    function render() {
        const w = canvas.width;
        const h = canvas.height;
        const cs = state.cellSize * state.zoom;
        const hs = state.headerSize;

        // 1. Clear
        ctx.fillStyle = COLORS.bg;
        ctx.fillRect(0, 0, w, h);

        const cols = Math.ceil((w - hs) / cs) + 1;
        const rows = Math.ceil((h - hs) / cs) + 1;
        const sx = state.panX;
        const sy = state.panY;

        // Font Size Logic
        let fontSize = Math.max(8, 12 * state.zoom);
        ctx.font = `${fontSize}px monospace`;
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";

        // --- GRID LOOP ---
        for (let r = 0; r < rows; r++) {
            let rowVal = state.startRow + BigInt(r * 2);
            let y = hs + sy + (r * cs);
            if (y < hs - cs) continue;

            for (let c = 0; c < cols; c++) {
                let colVal = state.startCol + BigInt(c * 2);
                let x = hs + sx + (c * cs);
                if (x < hs - cs) continue;

                // --- LOGIC ---
                // We calculate (A*B) % 30 to see if it matches Target
                let rMod = getMod30(rowVal);
                let cMod = getMod30(colVal);
                let pMod = (rMod * cMod) % 30;
                
                let isHit = (pMod === state.targetMod30);
                
                // Color Logic
                let fill = COLORS.wall;
                let textCol = COLORS.textDim;
                
                if (isHit) {
                    fill = 'rgba(245, 158, 11, 0.15)'; // Gold tint
                    textCol = COLORS.hit;
                } else if (state.showText) {
                    // Even if not a hit, we show the cell slightly lighter
                    fill = '#0b1221';
                }

                // Draw Box
                ctx.fillStyle = fill;
                ctx.fillRect(x + 1, y + 1, cs - 2, cs - 2);

                // Highlight Border if Hit
                if (isHit) {
                    ctx.strokeStyle = COLORS.hit;
                    ctx.lineWidth = 2 * state.zoom;
                    ctx.strokeRect(x + 2, y + 2, cs - 4, cs - 4);
                }

                // DRAW EQUATION (The "Not Boring" Part)
                if (state.showText && state.zoom > 0.4) {
                    ctx.fillStyle = textCol;
                    
                    // Top line: A x B
                    ctx.fillText(fmtCell(rowVal, colVal), x + cs/2, y + cs/2 - (5*state.zoom));
                    
                    // Bottom line: Modulo Result (Debug info for user)
                    if (state.zoom > 0.8) {
                        ctx.font = `${fontSize * 0.8}px monospace`;
                        ctx.fillStyle = isHit ? COLORS.hit : '#334155';
                        ctx.fillText(`MOD 30: ${pMod}`, x + cs/2, y + cs/2 + (10*state.zoom));
                        // Reset font
                        ctx.font = `${fontSize}px monospace`; 
                    }
                }
            }
        }

        // --- HEADERS (Sticky) ---
        ctx.fillStyle = COLORS.header;
        ctx.fillRect(hs, 0, w, hs);
        ctx.fillRect(0, hs, hs, h);
        ctx.fillStyle = COLORS.bg;
        ctx.fillRect(0, 0, hs, hs); // Corner

        ctx.fillStyle = '#10b981';
        ctx.font = "bold 12px monospace";
        ctx.fillText("AxB", hs/2, hs/2);

        // Col Headers
        ctx.font = "11px monospace";
        ctx.fillStyle = COLORS.text;
        for (let c = 0; c < cols; c++) {
            let colVal = state.startCol + BigInt(c * 2);
            let x = hs + sx + (c * cs);
            if (x < hs) continue;
            
            // Format: "..1234"
            let txt = colVal.toString();
            if (txt.length > 5) txt = ".." + txt.slice(-5);
            
            ctx.fillText(txt, x + cs/2, hs/2);
        }

        // Row Headers
        for (let r = 0; r < rows; r++) {
            let rowVal = state.startRow + BigInt(r * 2);
            let y = hs + sy + (r * cs);
            if (y < hs) continue;
            
            let txt = rowVal.toString();
            if (txt.length > 5) txt = ".." + txt.slice(-5);
            ctx.fillText(txt, hs/2, y + cs/2);
        }

        // Borders
        ctx.strokeStyle = '#334155';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(hs, 0); ctx.lineTo(hs, h);
        ctx.moveTo(0, hs); ctx.lineTo(w, hs);
        ctx.stroke();
    }

    // --- LOGIC ENGINE ---
    function hunt(inputStr) {
        const N = parseInput(inputStr);
        state.targetBig = N;
        state.targetMod30 = getMod30(N);
        
        // Update UI
        let modStr = state.targetMod30;
        let info = `MOD 30: ${modStr}`;
        if (modStr % 2 === 0 || modStr % 3 === 0 || modStr % 5 === 0) {
            info += " (DIVISIBLE!)";
        } else {
            info += " (PRIME CANDIDATE)";
        }
        document.getElementById('val-geo').innerText = info;

        // Jump Logic:
        // Set StartCol to roughly N / 3
        state.startCol = N / 3n;
        if (state.startCol % 2n === 0n) state.startCol += 1n; // Keep odd
        
        state.startRow = 3n;
        state.panX = 0; state.panY = 0;
        
        requestAnimationFrame(render);
    }

    // --- INTERACTION ---
    
    // Tap Handling (Open Inspector)
    function handleTap(x, y) {
        if (x < state.headerSize || y < state.headerSize) return;

        const cs = state.cellSize * state.zoom;
        const cIdx = Math.floor((x - state.headerSize - state.panX) / cs);
        const rIdx = Math.floor((y - state.headerSize - state.panY) / cs);
        
        const rVal = state.startRow + BigInt(rIdx * 2);
        const cVal = state.startCol + BigInt(cIdx * 2);
        const prod = rVal * cVal;
        
        // Populate Panel
        document.getElementById('ins-a').innerText = rVal.toString();
        document.getElementById('ins-b').innerText = cVal.toString();
        document.getElementById('ins-prod').innerText = prod.toString(); // Full Symbolic Expansion
        document.getElementById('ins-coords').innerText = `Row ${rIdx} : Col ${cIdx}`;
        
        // Check Match
        let pMod = getMod30(prod);
        let match = (pMod === state.targetMod30);
        document.getElementById('ins-mod').innerText = `${pMod} ${match ? "(MATCH)" : "(NO MATCH)"}`;
        document.getElementById('ins-mod').style.color = match ? COLORS.hit : '#64748b';

        // Open Panel
        document.getElementById('inspector').classList.add('open');
    }

    // Input Listeners
    let isDrag = false, lastX=0, lastY=0, tapX=0, tapY=0;

    canvas.addEventListener('pointerdown', e => {
        isDrag = true; lastX = e.clientX; lastY = e.clientY; tapX = e.clientX; tapY = e.clientY;
        canvas.setPointerCapture(e.pointerId);
    });
    canvas.addEventListener('pointerup', e => {
        isDrag = false; canvas.releasePointerCapture(e.pointerId);
        if (Math.hypot(e.clientX-tapX, e.clientY-tapY) < 5) handleTap(e.clientX, e.clientY);
    });
    canvas.addEventListener('pointermove', e => {
        if (!isDrag) return;
        let dx = e.clientX - lastX; let dy = e.clientY - lastY;
        lastX = e.clientX; lastY = e.clientY;
        state.panX += dx; state.panY += dy;
        
        // Infinite Scroll Calc
        const cs = state.cellSize * state.zoom;
        while(state.panX > 0) { state.startCol -= 2n; state.panX -= cs; }
        while(state.panX < -cs) { state.startCol += 2n; state.panX += cs; }
        while(state.panY > 0) { state.startRow -= 2n; state.panY -= cs; }
        while(state.panY < -cs) { state.startRow += 2n; state.panY += cs; }
        if (state.startRow < 3n) state.startRow = 3n;

        requestAnimationFrame(render);
    });
    canvas.addEventListener('wheel', e => {
        e.preventDefault();
        let s = e.deltaY > 0 ? 0.9 : 1.1;
        state.zoom = Math.max(0.2, Math.min(state.zoom, 3.0));
        document.getElementById('val-zoom').innerText = state.zoom.toFixed(1) + "x";
        requestAnimationFrame(render);
    }, {passive:false});

    // Buttons
    document.getElementById('btn-go').addEventListener('click', () => {
        hunt(document.getElementById('inp-target').value);
    });
    
    document.getElementById('btn-view').addEventListener('click', () => {
        state.showText = !state.showText;
        document.getElementById('btn-view').style.color = state.showText ? '#fff' : '#64748b';
        requestAnimationFrame(render);
    });

    document.getElementById('btn-close-panel').addEventListener('click', () => {
        document.getElementById('inspector').classList.remove('open');
    });

    // Init
    window.addEventListener('resize', () => {
        canvas.width = document.getElementById('viewport').clientWidth;
        canvas.height = document.getElementById('viewport').clientHeight;
        requestAnimationFrame(render);
    });
    
    canvas.width = document.getElementById('viewport').clientWidth;
    canvas.height = document.getElementById('viewport').clientHeight;
    
    // Auto-load that massive number? Or default.
    hunt("10^100 + 19");

</script>
</body>
</html>
