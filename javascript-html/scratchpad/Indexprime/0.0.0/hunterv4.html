<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hunter v4: Turbo Gnomon</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
    :root {
        --bg: #050505;
        --panel: #0a0a0a;
        --accent: #00ff9d; /* Turbo Green */
        --hit: #ff0055;    /* Impact Red */
        --wall: #0088ff;
        --text: #e0e0e0;
    }
    
    body { background-color: var(--bg); color: var(--text); font-family: 'Courier New', monospace; padding: 20px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
    
    .dashboard { width: 100%; max-width: 900px; display: grid; gap: 20px; }
    
    .card { background: var(--panel); border: 1px solid #222; padding: 20px; box-shadow: 0 0 40px rgba(0,255,157,0.05); }
    .card-header { display: flex; justify-content: space-between; border-bottom: 1px solid #222; padding-bottom: 10px; margin-bottom: 15px; }
    .card-title { font-weight: 900; color: var(--accent); letter-spacing: 2px; }
    
    .input-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    label { font-size: 0.6rem; color: #666; display: block; margin-bottom: 4px; text-transform: uppercase; }
    input { width: 100%; background: #000; border: 1px solid #333; color: var(--accent); padding: 10px; font-family: monospace; text-align: center; font-size: 1.1rem; outline: none; transition: border 0.3s; }
    input:focus { border-color: var(--accent); box-shadow: 0 0 15px rgba(0,255,157,0.2); }

    /* VISUALIZER */
    .road-viz { 
        display: flex; align-items: center; justify-content: center; 
        padding: 40px 20px; background: #000; 
        border-top: 2px solid #222; border-bottom: 2px solid #222; 
        position: relative; overflow: hidden; margin: 20px 0;
    }
    
    .gnomon-wheel {
        position: absolute; top: 10px; right: 10px; opacity: 0.3;
        width: 30px; height: 30px; border: 2px dashed var(--accent); border-radius: 50%;
        animation: spin 2s linear infinite;
    }
    @keyframes spin { 100% { transform: rotate(360deg); } }

    .target-marker { 
        width: 70px; height: 70px; background: #111; border: 2px solid #333; 
        display: flex; flex-direction: column; align-items: center; justify-content: center; 
        font-weight: bold; font-size: 0.8rem; z-index: 20; color: #666;
    }
    .target-marker.active { border-color: var(--accent); color: var(--accent); box-shadow: 0 0 30px rgba(0,255,157,0.1); }
    .target-marker.hit { border-color: var(--hit); background: rgba(255,0,85,0.2); box-shadow: 0 0 50px var(--hit); color: #fff; }

    /* TROPHY CASE */
    .trophy-case { 
        margin-top: 15px; display: grid; grid-template-columns: 1fr; gap: 8px; 
        max-height: 200px; overflow-y: auto; padding: 5px; 
    }
    .trophy { 
        background: #0f0f0f; border-left: 4px solid var(--hit); padding: 10px; 
        font-size: 0.8rem; display: flex; justify-content: space-between; align-items: center;
        animation: slideIn 0.3s ease-out;
    }
    .trophy span { font-family: monospace; }
    .sundaram-idx { color: #666; font-size: 0.7rem; }
    @keyframes slideIn { 0% { transform: translateX(-20px); opacity: 0; } 100% { transform: translateX(0); opacity: 1; } }

    .stats { display: flex; justify-content: space-between; font-size: 0.75rem; color: #666; margin-top: 10px; }
    .stat-val { color: var(--text); font-weight: bold; }

    .btn { width: 100%; padding: 15px; font-weight: 900; letter-spacing: 2px; background: #111; color: var(--accent); border: 1px solid var(--accent); cursor: pointer; transition: all 0.2s; margin-top: 15px; }
    .btn:hover { background: var(--accent); color: #000; box-shadow: 0 0 30px var(--accent); }
    .btn.stop { border-color: var(--hit); color: var(--hit); }
    .btn.stop:hover { background: var(--hit); color: #fff; }

    .log-box { height: 100px; overflow-y: auto; font-size: 0.7rem; color: #555; margin-top: 15px; border-top: 1px solid #222; padding-top: 10px; }
</style>
</head>
<body>

<div class="dashboard">
    <div class="card">
        <div class="card-header">
            <span class="card-title">HUNTER v4</span>
            <span style="font-size:0.7rem; color:#444">TURBO GNOMON</span>
        </div>
        
        <div class="input-grid">
            <div><label>Base</label><input id="inpBase" value="10"></div>
            <div><label>Exponent</label><input id="inpExp" value="1000000000"></div>
            <div><label>Add</label><input id="inpAdd" value="19"></div>
        </div>

        <div class="road-viz">
            <div id="wheelIcon" class="gnomon-wheel" style="display:none"></div>
            <div style="flex:1; height:1px; background:#222"></div>
            <div id="targetMarker" class="target-marker">N</div>
            <div style="flex:1; height:1px; background:#222"></div>
        </div>

        <div class="stats">
            <span>Rulers: <span id="rulerCount" class="stat-val">0</span></span>
            <span>Speed: <span id="speedVal" class="stat-val">0</span> /sec</span>
        </div>

        <button id="btnRun" class="btn" onclick="toggleEngine()">IGNITE ENGINE</button>

        <div id="trophyCase" class="trophy-case"></div>
        <div id="logBox" class="log-box">System Ready. Wheel 30 + Exponent Indexing Loaded.</div>
    </div>
</div>

<script>
// --- WORKER: THE TURBO GNOMON ---
const workerBlob = new Blob([`
    self.onmessage = function(e) {
        const { cmd, baseStr, expStr, addStr } = e.data;
        
        if (cmd === 'start') {
            const base = BigInt(baseStr);
            const exp = BigInt(expStr); // The Massive Exponent
            const add = BigInt(addStr);
            
            // --- OPTIMIZATION 2: EXPONENT INDEXING ---
            // Calculates (base^exp + add) % m efficiently
            // Uses Fermat's Little Theorem: base^(m-1) = 1 mod m
            // We reduce the exponent first: expReduced = exp % (m-1)
            function checkSnap(m) {
                // 1. Reduce the Exponent (The Index Shortcut)
                const mBI = BigInt(m);
                const reducedExp = exp % (mBI - 1n); 
                
                // 2. Teleport (Modular Exponentiation)
                let r = 1n;
                let b = base % mBI;
                let e = reducedExp;
                
                while (e > 0n) {
                    if ((e & 1n) === 1n) r = (r * b) % mBI;
                    b = (b * b) % mBI;
                    e >>= 1n;
                }
                
                // 3. The Snap
                return (r + add) % mBI === 0n;
            }

            // --- OPTIMIZATION 1: WHEEL 30 GNOMON ---
            // Only checks candidates at offsets [1,7,11,13,17,19,23,29]
            // Skips 2, 3, 5 and all their multiples automatically.
            const wheel = [1, 7, 11, 13, 17, 19, 23, 29];
            const wheelSize = 30;
            
            // Starting block
            let d = 0; 
            let count = 0;
            let lastUpdate = Date.now();

            // Check small primes manually first (safety)
            const smalls = [7, 11, 13, 17, 19, 23, 29, 31]; // 2,3,5 skipped by logic
            for(let p of smalls) {
                if(checkSnap(p)) postMessage({ type: 'snap', ruler: p });
            }
            d = 30; // Start wheel loop at 30

            while(true) {
                for (let i = 0; i < 8; i++) {
                    const ruler = d + wheel[i];
                    
                    // Note: We are checking 'ruler' which might be composite (e.g. 49).
                    // This is FASTER than sieving for primes because powMod is cheap.
                    // If 49 snaps, 7 would have snapped earlier. 
                    // This is the "Dirty Driver" method.
                    
                    if (checkSnap(ruler)) {
                        postMessage({ type: 'snap', ruler: ruler });
                    }
                    count++;
                }
                
                d += wheelSize;

                // Batch reporting
                if (count % 100000 === 0) {
                    const now = Date.now();
                    if (now - lastUpdate > 200) {
                        postMessage({ type: 'prog', count: count, current: d });
                        lastUpdate = now;
                    }
                }
            }
        }
    }
`], { type: 'application/javascript' });

// --- MAIN THREAD ---
let worker = null;
let isRunning = false;
let lastCount = 0;
let lastTime = 0;

const el = (id) => document.getElementById(id);
const log = (msg) => {
    const d = document.createElement('div');
    d.textContent = `> ${msg}`;
    el('logBox').prepend(d);
}

function toggleEngine() {
    if(isRunning) return stopEngine();
    
    // UI Reset
    el('trophyCase').innerHTML = '';
    el('rulerCount').innerText = '0';
    el('speedVal').innerText = '0';
    el('targetMarker').className = 'target-marker active';
    el('targetMarker').innerHTML = '<span style="font-size:1.5rem">N</span>';
    el('wheelIcon').style.display = 'block';
    
    el('btnRun').innerText = "ABORT SEQUENCE";
    el('btnRun').classList.add('stop');
    
    // Start Worker
    isRunning = true;
    lastCount = 0;
    lastTime = Date.now();
    
    worker = new Worker(URL.createObjectURL(workerBlob));
    worker.onmessage = handleWorker;
    
    const base = el('inpBase').value;
    const exp = el('inpExp').value;
    const add = el('inpAdd').value;
    
    log(`Target Locked: ${base}^${exp} + ${add}`);
    log("Wheel 30 Spooling up...");
    
    worker.postMessage({ cmd:'start', baseStr:base, expStr:exp, addStr:add });
}

function handleWorker(e) {
    const d = e.data;
    
    if(d.type === 'prog') {
        el('rulerCount').innerText = d.current.toLocaleString();
        
        // Calc Speed
        const now = Date.now();
        const diff = now - lastTime;
        if(diff > 1000) {
            const spd = (d.count - lastCount) / (diff/1000);
            el('speedVal').innerText = Math.round(spd).toLocaleString();
            lastCount = d.count;
            lastTime = now;
        }
    }
    
    if(d.type === 'snap') {
        const p = d.ruler;
        log(`SNAP! Factor found: ${p}`);
        addTrophy(p);
        
        // Visual Hit
        const m = el('targetMarker');
        m.classList.add('hit');
        m.innerHTML = `<span style="font-size:0.8rem">SNAP</span><span style="font-size:1.2rem">${p}</span>`;
        setTimeout(() => {
            if(isRunning) {
                m.classList.remove('hit');
                m.innerHTML = '<span style="font-size:1.5rem">N</span>';
            }
        }, 800);
    }
}

function addTrophy(p) {
    // Calculate Sundaram Index (k)
    // k = ((N/p) - 1) / 2
    // Since N is massive, we simplify display logic.
    // N = P * (2k+1) -> k is implicitly defined by P.
    // We can't display k for 10^1000000, but we can show the logic.
    
    const div = document.createElement('div');
    div.className = 'trophy';
    div.innerHTML = `
        <div>
            <div style="color:#fff; font-weight:bold; font-size:1.1rem">${p}</div>
            <div class="sundaram-idx">Ruler (Prime P)</div>
        </div>
        <div style="text-align:right">
            <div style="color:var(--accent)">MATCH</div>
            <div class="sundaram-idx">Index k Found</div>
        </div>
    `;
    el('trophyCase').prepend(div);
}

function stopEngine() {
    if(worker) worker.terminate();
    worker = null;
    isRunning = false;
    
    el('btnRun').innerText = "IGNITE ENGINE";
    el('btnRun').classList.remove('stop');
    el('wheelIcon').style.display = 'none';
    el('statusTxt').innerText = "OFFLINE";
    log("Engine Stopped.");
}
</script>
</body>
</html>
