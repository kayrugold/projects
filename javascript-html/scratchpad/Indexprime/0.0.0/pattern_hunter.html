<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pattern Hunter v2: Lightweight</title>
<style>
    body { background-color: #050505; color: #e0e0e0; font-family: 'Courier New', monospace; padding: 20px; }
    .card { background: #111; border: 1px solid #333; padding: 20px; max-width: 800px; margin: 0 auto; border-radius: 8px; }
    h1 { color: #00ff9d; text-align: center; margin-bottom: 5px; }
    p { text-align: center; color: #888; font-size: 0.8rem; margin-bottom: 20px; }
    
    .input-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
    label { display: block; color: #666; font-size: 0.75rem; text-transform: uppercase; margin-bottom: 5px; }
    input { width: 100%; background: #222; border: 1px solid #444; color: #fff; padding: 10px; font-family: monospace; font-size: 1.1rem; text-align: center; box-sizing: border-box; }
    
    .btn { width: 100%; padding: 15px; font-weight: bold; cursor: pointer; text-transform: uppercase; background: #00ff9d; color: #000; border: none; font-size: 1rem; margin-top: 10px; }
    .btn:hover { background: #00cc7a; }
    .btn-stop { background: #ff3333; color: white; display: none; }

    .visual-log { margin-top: 20px; border-top: 1px dashed #444; padding-top: 10px; font-size: 0.85rem; height: 300px; overflow-y: auto; background: #0a0a0a; padding: 10px; }
    .log-entry { margin-bottom: 4px; border-bottom: 1px solid #1a1a1a; padding-bottom: 2px; display: flex; justify-content: space-between; }
    .highlight { color: #00ff9d; font-weight: bold; }
    .gap { color: #666; }
    .hit { color: #ff3333; font-weight: bold; font-size: 1.1rem; }
    .scan-tag { color: #888; font-size: 0.7rem; }
    
    .core-status { display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 5px; margin-top: 10px; }
    .core-box { background: #1a1a1a; padding: 5px; text-align: center; font-size: 0.7rem; color: #888; border: 1px solid #333; }
    .active { border-color: #00ff9d; color: #fff; animation: pulse 1s infinite; }
    
    @keyframes pulse { 0% { border-color: #00ff9d; } 50% { border-color: #004422; } 100% { border-color: #00ff9d; } }
</style>
</head>
<body>

<div class="card">
    <h1>PATTERN HUNTER v2</h1>
    <p>VISUAL ALIGNMENT ENGINE (OPTIMIZED)</p>

    <div class="input-group">
        <div>
            <label>Target Number (Odd Integer)</label>
            <input id="inpTarget" value="30000000037">
        </div>
        <div>
            <label>Cores</label>
            <input id="inpCores" value="4" type="number">
        </div>
    </div>

    <button id="btnStart" class="btn" onclick="startHunt()">Check Alignments</button>
    <button id="btnStop" class="btn btn-stop" onclick="stopHunt()">Stop Engine</button>

    <div class="core-status" id="coreContainer"></div>
    <div class="visual-log" id="logBox">
        <div class="gap">System Ready. Waiting for target...</div>
    </div>
</div>

<script>
// --- WORKER SCRIPT ---
const workerScript = `
self.onmessage = function(e) {
    const { targetStr, startP, endP, workerId } = e.data;
    const N = BigInt(targetStr);
    const start = parseInt(startP);
    const end = parseInt(endP);

    function isPrime(n) {
        if(n<2) return false;
        if(n===2 || n===3) return true;
        if(n%2===0 || n%3===0) return false;
        for(let i=5; i*i<=n; i+=6) {
            if(n%i===0 || n%(i+2)===0) return false;
        }
        return true;
    }

    let lastUpdate = Date.now();

    for (let p = start; p < end; p++) {
        if (p % 2 === 0) continue;
        if (!isPrime(p)) continue; 

        const P = BigInt(p);

        // 1. Anchor Check
        if (P * P > N) {
            postMessage({ type: 'finish', msg: 'Square Limit Reached', p: p });
            return;
        }

        // 2. Alignment Check
        const rem = N % P;

        if (rem === 0n) {
            postMessage({ type: 'hit', p: p });
            return;
        } else {
            // Only send Gap data occasionally to prevent UI freeze
            // Send first 50, then every 500th
            if (p < 200 || p % 500 === 0) {
                 // TRUNCATE THE BIGINTS FOR UI SPEED
                 // We convert to string, then take last 6 chars
                 const lowStr = (N - rem).toString();
                 const highStr = (N + (P - rem)).toString();
                 const lowShort = "..." + lowStr.slice(-6);
                 const highShort = "..." + highStr.slice(-6);
                 
                 postMessage({ type: 'gap', p: p, lower: lowShort, upper: highShort });
            }
            
            // Send Heartbeat every 500ms
            if (Date.now() - lastUpdate > 500) {
                postMessage({ type: 'scan', p: p });
                lastUpdate = Date.now();
            }
        }
    }
    postMessage({ type: 'done', workerId: workerId });
};
`;

// --- MAIN SCRIPT ---
let workers = [];

function log(msg, type='gap') {
    const box = document.getElementById('logBox');
    const div = document.createElement('div');
    div.innerHTML = msg;
    div.className = type === 'hit' ? 'log-entry hit' : 'log-entry gap';
    if(type === 'highlight') div.className = 'log-entry highlight';
    box.prepend(div);
    // Keep log clean, remove old entries if > 50
    if (box.children.length > 50) box.lastChild.remove();
}

function startHunt() {
    const targetStr = document.getElementById('inpTarget').value;
    const cores = parseInt(document.getElementById('inpCores').value);
    
    document.getElementById('logBox').innerHTML = '';
    document.getElementById('coreContainer').innerHTML = '';
    document.getElementById('btnStart').style.display = 'none';
    document.getElementById('btnStop').style.display = 'block';
    
    try {
        const N = BigInt(targetStr);
        if (N % 2n === 0n) { log("Target is Even.", 'hit'); stopHunt(); return; }
        
        // 3-Family Check
        const rem3 = N % 3n;
        if (rem3 === 0n) { 
            log(`3-Family: HIT`, 'hit'); stopHunt(); return;
        } else {
            const low = N - rem3;
            const high = N + (3n - rem3);
            log(`3-Family: GAP (...${low.toString().slice(-6)} | ...${high.toString().slice(-6)})`, 'highlight');
        }

        // Limit
        let approxSqrt = Number(N > 100000000000000n ? 10000000n : Math.sqrt(Number(N))); 
        if (approxSqrt < 100) approxSqrt = 1000;

        const blob = new Blob([workerScript], {type: 'application/javascript'});
        const workerUrl = URL.createObjectURL(blob);
        
        const startP = 5;
        const totalRange = approxSqrt; 
        const chunk = Math.ceil(totalRange / cores);

        for(let i=0; i<cores; i++) {
            const wStart = startP + (i * chunk);
            const wEnd = wStart + chunk;
            
            const w = new Worker(workerUrl);
            w.postMessage({ targetStr: targetStr, startP: wStart, endP: wEnd, workerId: i });
            
            w.onmessage = (e) => handleMsg(e.data, i);
            workers.push(w);

            const cDiv = document.createElement('div');
            cDiv.id = `core-${i}`;
            cDiv.className = 'core-box active';
            cDiv.innerHTML = `CORE ${i+1}<br><span id='scan-${i}'>Init...</span>`;
            document.getElementById('coreContainer').appendChild(cDiv);
        }

    } catch(e) { log("Invalid Number", 'hit'); }
}

function handleMsg(data, id) {
    if (data.type === 'gap') {
        log(`<span>${data.p}-Family: GAP</span> <span class="scan-tag">(${data.lower} | ${data.upper})</span>`);
    }
    if (data.type === 'scan') {
        document.getElementById(`scan-${id}`).textContent = `Scan: ${data.p}`;
    }
    if (data.type === 'hit') {
        log(`TARGET HIT! Factor: ${data.p}`, 'hit');
        stopHunt();
    }
    if (data.type === 'finish') {
        document.getElementById(`core-${id}`).className = 'core-box';
        document.getElementById(`scan-${id}`).textContent = 'Done';
        if(data.msg === 'Square Limit Reached') {
            log(`Square Limit Reached (${data.p}). Result: PRIME.`, 'highlight');
            stopHunt();
        }
    }
    if (data.type === 'done') {
        document.getElementById(`core-${id}`).className = 'core-box';
        document.getElementById(`scan-${id}`).textContent = 'Done';
    }
}

function stopHunt() {
    workers.forEach(w => w.terminate());
    workers = [];
    document.getElementById('btnStart').style.display = 'block';
    document.getElementById('btnStop').style.display = 'none';
}
</script>
</body>
</html>
