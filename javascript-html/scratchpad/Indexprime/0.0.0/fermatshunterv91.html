<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hunter v8: Cyclic Polynomial</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
    :root {
        --bg: #02040a;
        --panel: #0d1117;
        --accent: #d946ef; /* Fuchsia for Cycle */
        --hit: #22c55e;    /* Success Green */
        --text: #e2e8f0;
    }
    
    body { background-color: var(--bg); color: var(--text); font-family: 'Courier New', monospace; padding: 20px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
    
    .dashboard { width: 100%; max-width: 900px; display: grid; gap: 20px; }
    
    .card { background: var(--panel); border: 1px solid #1f2937; padding: 20px; box-shadow: 0 0 50px rgba(217, 70, 239, 0.05); border-radius: 12px; }
    .card-header { display: flex; justify-content: space-between; border-bottom: 1px solid #1f2937; padding-bottom: 10px; margin-bottom: 15px; }
    .card-title { font-weight: 900; color: var(--accent); letter-spacing: 2px; }
    
    .input-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    label { font-size: 0.6rem; color: #6b7280; display: block; margin-bottom: 4px; text-transform: uppercase; }
    input { width: 100%; background: #000; border: 1px solid #374151; color: var(--accent); padding: 12px; font-family: monospace; text-align: center; font-size: 1.1rem; outline: none; border-radius: 6px; transition: border 0.3s; }
    input:focus { border-color: var(--accent); box-shadow: 0 0 15px rgba(217, 70, 239, 0.2); }

    /* CYCLIC VISUALIZER */
    .track-viz { 
        height: 200px; background: #000; border: 1px solid #1f2937; 
        position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center;
        border-radius: 6px; margin: 20px 0;
    }
    
    .orbit-path {
        position: absolute; width: 140px; height: 140px;
        border: 1px dashed #333; border-radius: 50%;
    }
    
    .racer {
        position: absolute; width: 12px; height: 12px; border-radius: 50%;
        top: 50%; left: 50%; margin: -6px;
        box-shadow: 0 0 10px currentColor;
    }
    .turtle { background: #3b82f6; color: #3b82f6; }
    .hare { background: var(--accent); color: var(--accent); }

    /* TROPHY CASE */
    .trophy-case { 
        margin-top: 15px; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 8px; 
        max-height: 200px; overflow-y: auto; padding: 5px; 
    }
    .trophy { 
        background: #0f1520; border: 1px solid var(--hit); padding: 10px; 
        font-size: 0.9rem; text-align: center; font-weight: bold; color: var(--hit);
        border-radius: 6px; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    @keyframes popIn { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

    .btn { width: 100%; padding: 16px; font-weight: 900; letter-spacing: 2px; background: #111827; color: var(--accent); border: 1px solid var(--accent); cursor: pointer; transition: all 0.2s; border-radius: 6px; }
    .btn:hover { background: var(--accent); color: #000; box-shadow: 0 0 30px var(--accent); }
    .btn.stop { border-color: var(--hit); color: var(--hit); }
    .btn.stop:hover { background: var(--hit); color: #fff; }

    .log-box { height: 100px; overflow-y: auto; font-size: 0.7rem; color: #6b7280; margin-top: 15px; border-top: 1px solid #1f2937; padding-top: 10px; }
</style>
</head>
<body>

<div class="dashboard">
    <div class="card">
        <div class="card-header">
            <span class="card-title">HUNTER v8</span>
            <span style="font-size:0.7rem; color:#6b7280">CYCLIC POLYNOMIAL</span>
        </div>
        
        <div class="input-grid">
            <div><label>Base</label><input id="inpBase" value="10"></div>
            <div><label>Exponent</label><input id="inpExp" value="18"></div>
            <div><label>Add (+C)</label><input id="inpAdd" value="1"></div>
        </div>

        <div class="track-viz">
            <div class="orbit-path"></div>
            <div id="turtle" class="racer turtle"></div>
            <div id="hare" class="racer hare"></div>
            <div style="position:absolute; font-size:0.7rem; color:#444;">f(x) = xÂ² + c</div>
        </div>

        <div class="flex justify-between text-xs text-gray-500 mb-2">
            <span>Poly Iterations: <span id="iterCount" class="text-white font-bold">0</span></span>
            <span>Speed: <span id="speedVal" class="text-white font-bold">0</span>/s</span>
        </div>

        <button id="btnRun" class="btn" onclick="toggleEngine()">START CYCLE</button>

        <div id="trophyCase" class="trophy-case"></div>
        <div id="logBox" class="log-box">System Ready. Polynomial Engine (Pollard's Rho) Loaded.</div>
    </div>
</div>

<script>
// --- WORKER: POLLARD'S RHO (The Racetrack) ---
const workerBlob = new Blob([`
    // GCD Function (Euclidean)
    function gcd(a, b) {
        if (a < 0n) a = -a;
        if (b < 0n) b = -b;
        while (b > 0n) {
            let temp = b;
            b = a % b;
            a = temp;
        }
        return a;
    }

    self.onmessage = function(e) {
        const { cmd, baseStr, expStr, addStr } = e.data;
        
        if (cmd === 'start') {
            const base = BigInt(baseStr);
            const exp = BigInt(expStr);
            const add = BigInt(addStr);
            
            // Calculate Target N
            const N = (base ** exp) + add;
            
            postMessage({ type: 'log', msg: 'Target N calculated. Entering Orbit...' });

            // POLLARD'S RHO CONFIG
            // Polynomial: f(x) = (x^2 + c) % N
            let x = 2n;      // Turtle
            let y = 2n;      // Hare
            let c = 1n;      // Polynomial Constant
            let d = 1n;      // The GCD (Factor)
            let count = 0;
            let cycleLimit = 0; // Check small batch
            
            let lastUpdate = Date.now();

            while (d === 1n) {
                // 1. Advance Turtle (1 step)
                x = (x * x + c) % N;
                
                // 2. Advance Hare (2 steps)
                y = (y * y + c) % N;
                y = (y * y + c) % N;
                
                // 3. Check for Snap (GCD)
                // We check |x - y|
                let diff = (x > y) ? (x - y) : (y - x);
                d = gcd(diff, N);
                
                count++;

                // Reporting
                if (count % 2000 === 0) {
                    const now = Date.now();
                    if (now - lastUpdate > 100) {
                        postMessage({ type: 'prog', i: count });
                        lastUpdate = now;
                    }
                }

                // If cycle failed (d == N), reset with new polynomial
                if (d === N) {
                    postMessage({ type: 'log', msg: 'Cycle collapsed. Adjusting polynomial...' });
                    x = BigInt(Math.floor(Math.random() * 1000));
                    y = x;
                    c += 1n; // Change the track shape
                    d = 1n;
                }
            }

            // We found a factor!
            postMessage({ type: 'hit', factor: d.toString() });
        }
    }
`], { type: 'application/javascript' });

// --- MAIN THREAD ---
let worker = null;
let isRunning = false;
let lastIter = 0;
let lastTime = 0;
let vizFrame = null;

const el = (id) => document.getElementById(id);
const log = (msg) => {
    const d = document.createElement('div');
    d.textContent = `> ${msg}`;
    el('logBox').prepend(d);
}

// Visualizer
let angleT = 0;
let angleH = 0;
function animateTrack() {
    if(!isRunning) return;
    
    // Turtle moves 1x, Hare moves 2x
    angleT += 0.05;
    angleH += 0.1;
    
    const r = 70; // Radius
    const tX = Math.cos(angleT) * r;
    const tY = Math.sin(angleT) * r;
    const hX = Math.cos(angleH) * r;
    const hY = Math.sin(angleH) * r;
    
    el('turtle').style.transform = `translate(${tX}px, ${tY}px)`;
    el('hare').style.transform = `translate(${hX}px, ${hY}px)`;
    
    vizFrame = requestAnimationFrame(animateTrack);
}

function toggleEngine() {
    if(isRunning) return stopEngine();
    
    el('trophyCase').innerHTML = '';
    el('iterCount').innerText = '0';
    el('speedVal').innerText = '0';
    el('btnRun').innerText = "ABORT CYCLE";
    el('btnRun').classList.add('stop');
    
    isRunning = true;
    lastIter = 0;
    lastTime = Date.now();
    
    const base = el('inpBase').value;
    const exp = el('inpExp').value;
    const add = el('inpAdd').value;
    
    log(`Initializing Racetrack: ${base}^${exp} + ${add}`);
    
    worker = new Worker(URL.createObjectURL(workerBlob));
    worker.onmessage = handleWorker;
    worker.postMessage({ cmd:'start', baseStr:base, expStr:exp, addStr:add });
    
    animateTrack();
}

function handleWorker(e) {
    const d = e.data;
    
    if(d.type === 'log') log(d.msg);
    
    if(d.type === 'prog') {
        el('iterCount').innerText = d.i.toLocaleString();
        
        const now = Date.now();
        const diff = now - lastTime;
        if(diff > 500) {
            const spd = (d.i - lastIter) / (diff/1000);
            el('speedVal').innerText = Math.round(spd).toLocaleString();
            lastIter = d.i;
            lastTime = now;
        }
    }
    
    if(d.type === 'hit') {
        log(`CYCLE SNAP! Factor Found.`, 'hit');
        addTrophy(d.factor);
        stopEngine();
    }
}

function addTrophy(f) {
    const div = document.createElement('div');
    div.className = 'trophy';
    div.innerText = f;
    el('trophyCase').appendChild(div);
}

function stopEngine() {
    if(worker) worker.terminate();
    if(vizFrame) cancelAnimationFrame(vizFrame);
    worker = null;
    isRunning = false;
    
    el('btnRun').innerText = "START CYCLE";
    el('btnRun').classList.remove('stop');
    log("Engine Halted.");
}
</script>
</body>
</html>
