<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pattern Hunter v3: Deep Sector</title>
<style>
    body { background-color: #020202; color: #00ff9d; font-family: 'Courier New', monospace; padding: 10px; margin: 0; }
    .card { background: #0a0a0a; border: 1px solid #1a1a1a; padding: 15px; max-width: 800px; margin: 0 auto; border-radius: 4px; box-shadow: 0 0 20px rgba(0, 255, 157, 0.05); }
    
    h1 { text-align: center; margin: 0 0 5px 0; font-size: 1.4rem; letter-spacing: 2px; text-shadow: 0 0 5px #00ff9d; }
    .subtitle { text-align: center; color: #444; font-size: 0.7rem; margin-bottom: 20px; text-transform: uppercase; }

    .control-panel { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
    label { display: block; color: #666; font-size: 0.65rem; text-transform: uppercase; margin-bottom: 4px; }
    input, select { width: 100%; background: #111; border: 1px solid #333; color: #fff; padding: 8px; font-family: monospace; font-size: 1rem; text-align: center; box-sizing: border-box; }
    input:focus { border-color: #00ff9d; outline: none; }

    .btn { width: 100%; padding: 15px; font-weight: 900; cursor: pointer; text-transform: uppercase; background: #00ff9d; color: #000; border: none; font-size: 1rem; letter-spacing: 1px; }
    .btn:active { background: #00cc7a; transform: translateY(1px); }
    .btn-stop { background: #ff3333; color: white; display: none; }

    /* CORE DASHBOARD */
    .core-grid { display: grid; grid-template-columns: 1fr; gap: 8px; margin-top: 15px; }
    .core-card { background: #111; border: 1px solid #333; padding: 10px; display: flex; flex-direction: column; position: relative; overflow: hidden; }
    .core-header { display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 5px; z-index: 2; }
    .core-status { font-size: 0.7rem; color: #888; z-index: 2; }
    
    .progress-track { height: 4px; background: #222; width: 100%; margin-top: 8px; z-index: 2; position: relative; }
    .progress-bar { height: 100%; background: #00ff9d; width: 0%; transition: width 0.3s linear; box-shadow: 0 0 10px #00ff9d; }
    
    /* ANIMATIONS */
    .active { border-color: #004422; }
    .flash { animation: flash 0.5s; }
    @keyframes flash { 0% { background-color: #00ff9d; } 100% { background-color: #111; } }

    /* LOGS */
    .log-box { margin-top: 20px; border-top: 1px dashed #333; padding-top: 10px; font-size: 0.75rem; height: 150px; overflow-y: auto; background: #050505; padding: 10px; color: #888; }
    .hit-log { color: #ff3333; font-weight: bold; border-bottom: 1px solid #ff3333; padding: 5px 0; font-size: 1rem; }
    .gap-log { border-bottom: 1px solid #1a1a1a; padding: 2px 0; display: flex; justify-content: space-between; }
    .mono { font-family: monospace; color: #aaa; }
</style>
</head>
<body>

<div class="card">
    <h1>PATTERN HUNTER v3</h1>
    <div class="subtitle">Deep Sector Scan // 8-Core Link</div>

    <div class="control-panel">
        <div>
            <label>Target (Odd Integer)</label>
            <input id="inpTarget" value="30000000037">
        </div>
        <div>
            <label>Scan Depth (Families)</label>
            <select id="inpDepth">
                <option value="10000000">10 Million (Quick)</option>
                <option value="50000000">50 Million (Deep)</option>
                <option value="200000000" selected>200 Million (Extreme)</option>
            </select>
        </div>
    </div>
    
    <div>
        <label>CPU Cores</label>
        <input id="inpCores" type="number" value="4" style="margin-bottom: 10px;">
    </div>

    <button id="btnStart" class="btn" onclick="startHunt()">Engage Deep Scan</button>
    <button id="btnStop" class="btn btn-stop" onclick="stopHunt()">Abort Mission</button>

    <div class="core-grid" id="coreContainer"></div>
    
    <div class="log-box" id="logBox">
        <div>System Ready. Awaiting Target...</div>
    </div>
</div>

<script>
// --- WORKER KERNEL ---
const workerScript = `
self.onmessage = function(e) {
    const { targetStr, startP, endP, workerId } = e.data;
    const N = BigInt(targetStr);
    const start = parseInt(startP);
    const end = parseInt(endP);
    const totalOps = end - start;

    function isPrime(n) {
        if(n<2) return false;
        if(n===2 || n===3) return true;
        if(n%2===0 || n%3===0) return false;
        for(let i=5; i*i<=n; i+=6) {
            if(n%i===0 || n%(i+2)===0) return false;
        }
        return true;
    }

    let lastReport = Date.now();
    let checked = 0;

    for (let p = start; p < end; p++) {
        // Optimization: Only check odds
        if (p % 2 === 0) continue;
        
        // Progress Calculation (Report every ~200ms)
        if (Date.now() - lastReport > 200) {
            const pct = ((p - start) / totalOps) * 100;
            postMessage({ type: 'progress', pct: pct.toFixed(1), current: p });
            lastReport = Date.now();
        }

        if (!isPrime(p)) continue; 

        const P = BigInt(p);

        // 1. Square Boundary Rule
        if (P * P > N) {
            postMessage({ type: 'finish', msg: 'Square Limit', p: p });
            return;
        }

        // 2. Alignment Logic
        const rem = N % P;

        if (rem === 0n) {
            postMessage({ type: 'hit', p: p });
            return;
        } else {
            // Log Gap for the first few (Proof of Logic)
            if (p < 100) {
                 const lowStr = (N - rem).toString();
                 const highStr = (N + (P - rem)).toString();
                 postMessage({ type: 'gap', p: p, lower: "..." + lowStr.slice(-6), upper: "..." + highStr.slice(-6) });
            }
        }
    }
    // Finished assigned chunk
    postMessage({ type: 'done', workerId: workerId });
};
`;

// --- MAIN CONTROLLER ---
let workers = [];

function log(html, type='') {
    const box = document.getElementById('logBox');
    const div = document.createElement('div');
    div.innerHTML = html;
    if(type === 'hit') div.className = 'hit-log';
    if(type === 'gap') div.className = 'gap-log';
    box.prepend(div);
    if(box.children.length > 30) box.lastChild.remove();
}

function startHunt() {
    const targetStr = document.getElementById('inpTarget').value;
    const depth = parseInt(document.getElementById('inpDepth').value);
    const cores = parseInt(document.getElementById('inpCores').value);
    
    // Reset
    document.getElementById('logBox').innerHTML = '';
    document.getElementById('coreContainer').innerHTML = '';
    document.getElementById('btnStart').style.display = 'none';
    document.getElementById('btnStop').style.display = 'block';
    
    try {
        const N = BigInt(targetStr);
        if (N % 2n === 0n) { log("TARGET IS EVEN (Divisible by 2)", 'hit'); stopHunt(); return; }
        if (N % 3n === 0n) { log("TARGET ALIGNMENT: 3-Family HIT", 'hit'); stopHunt(); return; }
        
        log(`Engaging ${cores} Cores. Target Sector: First ${depth.toLocaleString()} Families.`);
        log(`3-Family: GAP (Confirmed)`, 'gap');

        const blob = new Blob([workerScript], {type: 'application/javascript'});
        const workerUrl = URL.createObjectURL(blob);
        
        // Start after 3 (so 5)
        const startP = 5;
        const totalRange = depth; 
        const chunk = Math.ceil(totalRange / cores);

        for(let i=0; i<cores; i++) {
            const wStart = startP + (i * chunk);
            const wEnd = wStart + chunk;
            
            // UI Card
            const card = document.createElement('div');
            card.className = 'core-card active';
            card.innerHTML = `
                <div class="core-header">
                    <span>CORE ${i+1}</span>
                    <span id="pct-${i}" style="color:#00ff9d; font-weight:bold;">0.0%</span>
                </div>
                <div class="core-status">Scanning <span id="scan-${i}" class="mono">${wStart}</span>...</div>
                <div class="progress-track">
                    <div id="bar-${i}" class="progress-bar"></div>
                </div>
            `;
            document.getElementById('coreContainer').appendChild(card);

            // Worker Launch
            const w = new Worker(workerUrl);
            w.postMessage({ targetStr: targetStr, startP: wStart, endP: wEnd, workerId: i });
            w.onmessage = (e) => handleMsg(e.data, i);
            workers.push(w);
        }

    } catch(e) { log("INVALID INPUT", 'hit'); }
}

function handleMsg(data, id) {
    if (data.type === 'progress') {
        document.getElementById(`pct-${id}`).textContent = data.pct + '%';
        document.getElementById(`bar-${id}`).style.width = data.pct + '%';
        document.getElementById(`scan-${id}`).textContent = data.current;
    }
    if (data.type === 'gap') {
        log(`<span>${data.p}-Family GAP</span> <span class="mono">${data.lower} | ${data.upper}</span>`, 'gap');
    }
    if (data.type === 'hit') {
        log(`⚠️ HIT CONFIRMED: Factor ${data.p}`, 'hit');
        // Visual flash
        document.body.style.backgroundColor = '#220000';
        stopHunt();
    }
    if (data.type === 'finish') {
        if(data.msg === 'Square Limit') {
            log(`⏹️ SQUARE LIMIT REACHED at ${data.p}. Target is PRIME.`, 'hit');
            document.body.style.backgroundColor = '#002200';
            stopHunt();
        }
    }
    if (data.type === 'done') {
        document.getElementById(`pct-${id}`).textContent = 'SECTOR CLEAR';
        document.getElementById(`bar-${id}`).style.backgroundColor = '#444';
        document.getElementById(`scan-${id}`).textContent = 'Standby';
    }
}

function stopHunt() {
    workers.forEach(w => w.terminate());
    workers = [];
    document.getElementById('btnStart').style.display = 'block';
    document.getElementById('btnStop').style.display = 'none';
    log("Operations Halted.", 'gap');
}
</script>
</body>
</html>
