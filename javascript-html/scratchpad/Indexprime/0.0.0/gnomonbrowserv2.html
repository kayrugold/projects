<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Gnomon Equivalence Engine</title>
    <style>
        body { background: #0b1120; color: #e2e8f0; font-family: 'Segoe UI', monospace; display: flex; flex-direction: column; align-items: center; padding: 30px; }
        .input-group { margin-bottom: 40px; }
        input { background: #1e293b; border: 1px solid #334155; color: #fff; font-size: 1.5rem; padding: 10px; text-align: center; width: 300px; border-radius: 8px; }
        
        .equation-stage {
            display: grid;
            grid-template-columns: 1fr 100px 1fr;
            gap: 20px;
            align-items: center;
            width: 100%;
            max-width: 900px;
        }

        .system-card {
            background: #1e293b;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #334155;
            position: relative;
        }
        .system-card.linear { border-color: #f472b6; }
        .system-card.table { border-color: #0ea5e9; }

        .sys-title { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px; color: #94a3b8; }
        .math-row { font-size: 1.4rem; font-weight: bold; margin-bottom: 10px; display: flex; justify-content: space-between; }
        .dna-row { font-size: 0.9rem; color: #fbbf24; font-family: monospace; border-top: 1px solid #334155; padding-top: 10px; margin-top: 10px; }
        
        .equals-sign { font-size: 3rem; color: #64748b; text-align: center; }

        .highlight { color: #fff; }
        .pink { color: #f472b6; }
        .blue { color: #0ea5e9; }
        
        .grid-preview {
            margin-top: 30px;
            display: grid;
            grid-template-columns: repeat(3, 80px);
            gap: 5px;
            opacity: 0.5;
        }
        .cell { background: #334155; height: 80px; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .cell.center { background: #0ea5e9; color: #000; }

    </style>
</head>
<body>

    <div class="input-group">
        <input type="text" id="inputNum" value="1007" onkeyup="if(event.key==='Enter') solve()">
    </div>

    <div id="output" class="equation-stage" style="visibility: hidden;">
        <div class="system-card linear">
            <div class="sys-title">System A: Linear Gnomon</div>
            <div class="math-row">
                <span class="pink" id="linIdx">--</span>² - <span class="pink" id="linArm">--</span>²
            </div>
            <div class="dna-row" id="linDNA">
                DNA: Index ≡ 0 (mod 3)
            </div>
            <div style="font-size:0.8rem; color:#64748b; margin-top:5px">The "Trivial" Unpacking</div>
        </div>

        <div class="equals-sign">=</div>

        <div class="system-card table">
            <div class="sys-title">System B: Table Gnomon</div>
            <div class="math-row">
                <span class="blue" id="tblCenter">--</span>² - <span class="blue" id="tblGap">--</span>²
            </div>
            <div class="dna-row" id="tblDNA">
                DNA: Center ≡ 0 (mod 3)
            </div>
            <div style="font-size:0.8rem; color:#64748b; margin-top:5px" id="gridRef">Matches Grid: Row 19 x Col 53</div>
        </div>
    </div>

    <script>
        function solve() {
            let val = document.getElementById('inputNum').value;
            let N = BigInt(val);
            
            // 1. Linear Gnomon Math
            let linIdx = (N + 1n) / 2n;
            let linArm = linIdx - 1n;
            let linMod = linIdx % 3n;
            
            // 2. Table Gnomon Math (Simulated "Direct" Find for Demo)
            let center = findCenter(N, linMod);
            let gap = bigSqrt((center*center) - N);
            
            let Row = center - gap;
            let Col = center + gap;

            // Render
            document.getElementById('output').style.visibility = 'visible';
            
            // Linear Side
            document.getElementById('linIdx').innerText = linIdx;
            document.getElementById('linArm').innerText = linArm;
            document.getElementById('linDNA').innerText = `DNA: Index ≡ ${linMod} (mod 3)`;
            
            // Table Side
            document.getElementById('tblCenter').innerText = center;
            document.getElementById('tblGap').innerText = gap;
            document.getElementById('tblDNA').innerText = `DNA: Center ≡ ${center%3n} (mod 3)`;
            document.getElementById('gridRef').innerText = `Matches Grid: Row ${Row} x Col ${Col}`;
        }

        // The "Wall Hopper" Logic embedded in function
        function findCenter(target, targetMod) {
            let root = bigSqrt(target);
            let c = root + 1n;
            
            // ALIGN TO DNA (Mod 3)
            while (c % 3n !== targetMod) {
                c++;
            }
            
            // Hop by 3s until square found
            // This represents the "Rhythm" you described
            while (true) {
                let diff = c*c - target;
                let s = bigSqrt(diff);
                if (s*s === diff) return c;
                c += 3n; // JUMP 3
            }
        }

        function bigSqrt(n) {
            if (n < 0n) return 0n;
            if (n < 2n) return n;
            let x = n;
            let y = (x + n / x) / 2n;
            while (y < x) { x = y; y = (x + n / x) / 2n; }
            return x;
        }
        
        // Init
        solve();
    </script>
</body>
</html>
